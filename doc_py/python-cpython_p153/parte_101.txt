..

.. date: 2022-12-12-01-05-16
.. gh-issue: 99110
.. nonce: 1JqtIg
.. section: Core and Builtins

Initialize frame->previous in frameobject.c to fix a segmentation fault when
accessing frames created by :c:func:`PyFrame_New`.

..

.. date: 2022-12-12-00-59-11
.. gh-issue: 94155
.. nonce: LWE9y_
.. section: Core and Builtins

Improved the hashing algorithm for code objects, mitigating some hash
collisions.

..

.. date: 2022-12-10-20-00-13
.. gh-issue: 99540
.. nonce: ZZZHeP
.. section: Core and Builtins

``None`` now hashes to a constant value. This is not a requirements change.

..

.. date: 2022-12-09-14-27-36
.. gh-issue: 100143
.. nonce: 5g9rb4
.. section: Core and Builtins

When built with ``--enable-pystats``, stats collection is now off by
default. To enable it early at startup, pass the ``-Xpystats`` flag.  Stats
are now always dumped, even if switched off.

..

.. date: 2022-12-09-13-18-42
.. gh-issue: 100146
.. nonce: xLVKg0
.. section: Core and Builtins

Improve ``BUILD_LIST`` opcode so that it works similarly to the
``BUILD_TUPLE`` opcode, by stealing references from the stack rather than
repeatedly using stack operations to set list elements.  Implementation
details are in a new private API :c:func:`!_PyList_FromArraySteal`.

..

.. date: 2022-12-08-12-26-34
.. gh-issue: 100110
.. nonce: ertac-
.. section: Core and Builtins

Specialize ``FOR_ITER`` for tuples.

..

.. date: 2022-12-06-22-24-01
.. gh-issue: 100050
.. nonce: lcrPqQ
.. section: Core and Builtins

Honor existing errors obtained when searching for mismatching parentheses in
the tokenizer. Patch by Pablo Galindo

..

.. date: 2022-12-04-00-38-33
.. gh-issue: 92216
.. nonce: CJXuWB
.. section: Core and Builtins

Improve the performance of :func:`hasattr` for type objects with a missing
attribute.

..

.. date: 2022-11-19-01-11-06
.. gh-issue: 99582
.. nonce: wvOBVy
.. section: Core and Builtins

Freeze :mod:`zipimport` module into ``_bootstrap_python``.

..

.. date: 2022-11-16-05-57-24
.. gh-issue: 99554
.. nonce: A_Ywd2
.. section: Core and Builtins

Pack debugging location tables more efficiently during bytecode compilation.

..

.. date: 2022-10-21-16-10-39
.. gh-issue: 98522
.. nonce: s_SixG
.. section: Core and Builtins

Add an internal version number to code objects, to give better versioning of
inner functions and comprehensions, and thus better specialization of those
functions. This change is invisible to both Python and C extensions.

..

.. date: 2022-07-06-18-44-00
.. gh-issue: 94603
.. nonce: Q_03xV
.. section: Core and Builtins

Improve performance of ``list.pop`` for small lists.

..

.. date: 2022-06-17-08-00-34
.. gh-issue: 89051
.. nonce: yP4Na0
.. section: Core and Builtins

Add :const:`ssl.OP_LEGACY_SERVER_CONNECT`

..

.. bpo: 32782
.. date: 2018-02-06-23-21-13
.. nonce: EJVSfR
.. section: Core and Builtins

``ctypes`` arrays of length 0 now report a correct itemsize when a
``memoryview`` is constructed from them, rather than always giving a value
of 0.

..

.. date: 2023-01-08-12-10-17
.. gh-issue: 100833
.. nonce: f6cT7E
.. section: Library

Speed up :func:`math.fsum` by removing defensive ``volatile`` qualifiers.

..

.. date: 2023-01-07-15-13-47
.. gh-issue: 100805
.. nonce: 05rBz9
.. section: Library

Modify :func:`random.choice` implementation to once again work with NumPy
arrays.

..

.. date: 2023-01-06-22-36-27
.. gh-issue: 100813
.. nonce: mHRdQn
.. section: Library

Add :const:`socket.IP_PKTINFO` constant.

..

.. date: 2023-01-06-14-05-15
.. gh-issue: 100792
.. nonce: CEOJth
.. section: Library

Make :meth:`email.message.Message.__contains__` twice as fast.

..

.. date: 2023-01-05-23-04-15
.. gh-issue: 91851
.. nonce: AuCzU5
.. section: Library

Microoptimizations for :meth:`fractions.Fraction.__round__`,
:meth:`fractions.Fraction.__ceil__` and
:meth:`fractions.Fraction.__floor__`.

..

.. date: 2023-01-04-22-10-31
.. gh-issue: 90104
.. nonce: yZk5EX
.. section: Library

Avoid RecursionError on ``repr`` if a dataclass field definition has a
cyclic reference.

..

.. date: 2023-01-04-12-58-59
.. gh-issue: 100689
.. nonce: Ce0ITG
.. section: Library

Fix crash in :mod:`pyexpat` by statically allocating ``PyExpat_CAPI``
capsule.

..

.. date: 2023-01-04-09-53-38
.. gh-issue: 100740
.. nonce: -j5UjI
.. section: Library

Fix ``unittest.mock.Mock`` not respecting the spec for attribute names
prefixed with ``assert``.

..

.. date: 2023-01-03-11-06-28
.. gh-issue: 91219
.. nonce: s5IFCw
.. section: Library

Change ``SimpleHTTPRequestHandler`` to support subclassing to provide a
different set of index file names instead of using ``__init__`` parameters.

..

.. date: 2023-01-02-16-59-49
.. gh-issue: 100690
.. nonce: 2EgWPS
.. section: Library

``Mock`` objects which are not unsafe will now raise an ``AttributeError``
when accessing an attribute that matches the name of an assertion but
without the prefix ``assert_``, e.g. accessing ``called_once`` instead of
``assert_called_once``. This is in addition to this already happening for
accessing attributes with prefixes ``assert``, ``assret``, ``asert``,
``aseert``, and ``assrt``.

..

.. date: 2023-01-01-23-57-00
.. gh-issue: 89727
.. nonce: ojedHN
.. section: Library

Simplify and optimize :func:`os.walk` by using :func:`isinstance` checks to
check the top of the stack.

..

.. date: 2023-01-01-21-54-46
.. gh-issue: 100485
.. nonce: geNrHS
.. section: Library

Add math.sumprod() to compute the sum of products.

..

.. date: 2022-12-30-07-49-08
.. gh-issue: 86508
.. nonce: nGZDzC
.. section: Library

Fix :func:`asyncio.open_connection` to skip binding to local addresses of
different family. Patch by Kumar Aditya.

..

.. date: 2022-12-29-11-45-22
.. gh-issue: 97930
.. nonce: hrtmJe
.. section: Library

``importlib.resources.files`` now accepts a module as an anchor instead of
only accepting packages. If a module is passed, resources are resolved
adjacent to that module (in the same package or at the package root). The
parameter was renamed from ``package`` to ``anchor`` with a compatibility
shim for those passing by keyword. Additionally, the new ``anchor``
parameter is now optional and will default to the caller's module.

..

.. date: 2022-12-28-17-38-39
.. gh-issue: 100585
.. nonce: BiiTlG
.. section: Library

Fixed a bug where importlib.resources.as_file was leaving file pointers open

..

.. date: 2022-12-28-00-28-43
.. gh-issue: 100562
.. nonce: Hic0Z0
.. section: Library

Improve performance of :meth:`pathlib.Path.absolute` by nearly 2x. This
comes at the cost of a performance regression in :meth:`pathlib.Path.cwd`,
which is generally used less frequently in user code.

..

.. date: 2022-12-24-16-39-53
.. gh-issue: 100519
.. nonce: G_dZLP
.. section: Library

Small simplification of :func:`http.cookiejar.eff_request_host` that
improves readability and better matches the RFC wording.

..

.. date: 2022-12-24-08-42-05
.. gh-issue: 100287
.. nonce: n0oEuG
.. section: Library

Fix the interaction of :func:`unittest.mock.seal` with
:class:`unittest.mock.AsyncMock`.

..

.. date: 2022-12-24-04-13-54
.. gh-issue: 100488
.. nonce: Ut8HbE
.. section: Library

Add :meth:`Fraction.is_integer` to check whether a
:class:`fractions.Fraction` is an integer. This improves duck type
compatibility with :class:`float` and :class:`int`.

..

.. date: 2022-12-23-21-02-43
.. gh-issue: 100474
.. nonce: gppA4U
.. section: Library

:mod:`http.server` now checks that an index page is actually a regular file
before trying to serve it.  This avoids issues with directories named
``index.html``.

..

.. date: 2022-12-20-11-07-30
.. gh-issue: 100363
.. nonce: Wo_Beg
.. section: Library

Speed up :func:`asyncio.get_running_loop` by removing redundant ``getpid``
checks. Patch by Kumar Aditya.

..

.. date: 2022-12-19-20-54-04
.. gh-issue: 78878
.. nonce: JrkYqJ
.. section: Library

Fix crash when creating an instance of :class:`!_ctypes.CField`.

..

.. date: 2022-12-19-19-30-06
.. gh-issue: 100348
.. nonce: o7IAHh
.. section: Library

Fix ref cycle in :class:`!asyncio._SelectorSocketTransport` by removing
``_read_ready_cb`` in ``close``.

..

.. date: 2022-12-19-12-18-28
.. gh-issue: 100344
.. nonce: lfCqpE
.. section: Library

Provide C implementation for :func:`asyncio.current_task` for a 4x-6x
speedup.

..

.. date: 2022-12-15-18-28-13
.. gh-issue: 100272
.. nonce: D1O9Ey
.. section: Library

Fix JSON serialization of OrderedDict.  It now preserves the order of keys.

..

.. date: 2022-12-14-17-37-01
.. gh-issue: 83076
.. nonce: NaYzWT
.. section: Library

Instantiation of ``Mock()`` and ``AsyncMock()`` is now 3.8x faster.

..

.. date: 2022-12-14-11-45-38
.. gh-issue: 100234
.. nonce: kn6yWV
.. section: Library

Set a default value of 1.0 for the ``lambd`` parameter in
random.expovariate().

..

.. date: 2022-12-13-17-29-09
.. gh-issue: 100228
.. nonce: bgtzMV
.. section: Library

A :exc:`DeprecationWarning` may be raised when :func:`os.fork` or
:func:`os.forkpty` is called from multi-threaded processes.  Forking with
threads is unsafe and can cause deadlocks, crashes and subtle problems. Lack
of a warning does not indicate that the fork call was actually safe, as
Python may not be aware of all threads.

..

.. date: 2022-12-10-20-52-28
.. gh-issue: 100039
.. nonce: zDqjT4
.. section: Library

Improve signatures for enums and flags.

..

.. date: 2022-12-10-08-36-07
.. gh-issue: 100133
.. nonce: g-zQlp
.. section: Library

Fix regression in :mod:`asyncio` where a subprocess would sometimes lose
data received from pipe.

..

.. bpo: 44592
.. date: 2022-12-09-10-35-36
.. nonce: z-P3oe
.. section: Library

Fixes inconsistent handling of case sensitivity of *extrasaction* arg in
:class:`csv.DictWriter`.

..

.. date: 2022-12-08-06-18-06
.. gh-issue: 100098
.. nonce: uBvPlp
.. section: Library

Fix ``tuple`` subclasses being cast to ``tuple`` when used as enum values.

..

.. date: 2022-12-04-16-12-04
.. gh-issue: 85432
.. nonce: l_ehmI
.. section: Library

Rename the *fmt* parameter of the pure-Python implementation of
:meth:`datetime.time.strftime` to *format*. Rename the *t* parameter of
:meth:`datetime.datetime.fromtimestamp` to *timestamp*. These changes mean
the parameter names in the pure-Python implementation now match the
parameter names in the C implementation. Patch by Alex Waygood.

..

.. date: 2022-12-03-20-06-16
.. gh-issue: 98778
.. nonce: t5U9uc
.. section: Library

Update :exc:`~urllib.error.HTTPError` to be initialized properly, even if
the ``fp`` is ``None``. Patch by Donghee Na.

..

.. date: 2022-12-01-15-44-58
.. gh-issue: 99925
.. nonce: x4y6pF
.. section: Library

Unify error messages in JSON serialization between
``json.dumps(float('nan'), allow_nan=False)`` and ``json.dumps(float('nan'),
allow_nan=False, indent=<SOMETHING>)``. Now both include the representation
of the value that could not be serialized.

..

.. date: 2022-11-29-20-44-54
.. gh-issue: 89727
.. nonce: UJZjkk
.. section: Library

Fix issue with :func:`os.walk` where a :exc:`RecursionError` would occur on
deep directory structures by adjusting the implementation of :func:`os.walk`
to be iterative instead of recursive.

..

.. date: 2022-11-23-23-58-45
.. gh-issue: 94943
.. nonce: Oog0Zo
.. section: Library

Add :ref:`enum-dataclass-support` to the :class:`~enum.Enum`
:meth:`~enum.Enum.__repr__`. When inheriting from a
:class:`~dataclasses.dataclass`, only show the field names in the value
section of the member :func:`repr`, and not the dataclass' class name.

..

.. date: 2022-11-21-16-24-01
.. gh-issue: 83035
.. nonce: qZIujU
.. section: Library

Fix :func:`inspect.getsource` handling of decorator calls with nested
parentheses.

..

.. date: 2022-11-20-11-59-54
.. gh-issue: 99576
.. nonce: ZD7jU6
.. section: Library

Fix ``.save()`` method for ``LWPCookieJar`` and ``MozillaCookieJar``: saved
file was not truncated on repeated save.

..

.. date: 2022-11-17-10-02-18
.. gh-issue: 94912
.. nonce: G2aa-E
.. section: Library

Add :func:`inspect.markcoroutinefunction` decorator which manually marks a
function as a coroutine for the benefit of :func:`iscoroutinefunction`.

..

.. date: 2022-11-15-18-45-01
.. gh-issue: 99509
.. nonce: FLK0xU
.. section: Library

Add :pep:`585` support for :class:`multiprocessing.queues.Queue`.

..

.. date: 2022-11-14-19-58-36
.. gh-issue: 99482
.. nonce: XmZyUr
.. section: Library

Remove ``Jython`` partial compatibility code from several stdlib modules.

..

.. date: 2022-11-13-15-32-19
.. gh-issue: 99433
.. nonce: Ys6y0A
.. section: Library

Fix :mod:`doctest` failure on :class:`types.MethodWrapperType` in modules.

..

.. date: 2022-10-28-07-24-34
.. gh-issue: 85267
.. nonce: xUy_Wm
.. section: Library

Several improvements to :func:`inspect.signature`'s handling of
``__text_signature``. - Fixes a case where :func:`inspect.signature` dropped
parameters - Fixes a case where :func:`inspect.signature` raised
:exc:`tokenize.TokenError` - Allows :func:`inspect.signature` to understand
defaults involving binary operations of constants -
:func:`inspect.signature` is documented as only raising :exc:`TypeError` or
:exc:`ValueError`, but sometimes raised :exc:`RuntimeError`. These cases now
raise :exc:`ValueError` - Removed a dead code path

..

.. date: 2022-10-24-07-31-11
.. gh-issue: 91166
.. nonce: -IG06R
.. section: Library

:mod:`asyncio` is optimized to avoid excessive copying when writing to
socket and use :meth:`~socket.socket.sendmsg` if the platform supports it.
Patch by Kumar Aditya.

..

.. date: 2022-10-07-18-16-00
.. gh-issue: 98030
.. nonce: 2oQCZy
.. section: Library

Add missing TCP socket options from Linux: ``TCP_MD5SIG``,
``TCP_THIN_LINEAR_TIMEOUTS``, ``TCP_THIN_DUPACK``, ``TCP_REPAIR``,
``TCP_REPAIR_QUEUE``, ``TCP_QUEUE_SEQ``, ``TCP_REPAIR_OPTIONS``,
``TCP_TIMESTAMP``, ``TCP_CC_INFO``, ``TCP_SAVE_SYN``, ``TCP_SAVED_SYN``,
``TCP_REPAIR_WINDOW``, ``TCP_FASTOPEN_CONNECT``, ``TCP_ULP``,
``TCP_MD5SIG_EXT``, ``TCP_FASTOPEN_KEY``, ``TCP_FASTOPEN_NO_COOKIE``,
``TCP_ZEROCOPY_RECEIVE``, ``TCP_INQ``, ``TCP_TX_DELAY``.

..

.. date: 2022-09-16-08-21-46
.. gh-issue: 88500
.. nonce: jQ0pCc
.. section: Library

Reduced the memory usage of :func:`urllib.parse.unquote` and
:func:`urllib.parse.unquote_to_bytes` on large values.

..

.. date: 2022-08-27-10-35-50
.. gh-issue: 96127
.. nonce: 8RdLre
.. section: Library

``inspect.signature`` was raising ``TypeError`` on call with mock objects.
Now it correctly returns ``(*args, **kwargs)`` as inferred signature.

..

.. date: 2022-08-11-10-02-19
.. gh-issue: 95882
.. nonce: FsUr72
.. section: Library

Fix a 3.11 regression in :func:`~contextlib.asynccontextmanager`, which
caused it to propagate exceptions with incorrect tracebacks and fix a 3.11
regression in  :func:`~contextlib.contextmanager`, which caused it to
propagate exceptions with incorrect tracebacks for :exc:`StopIteration`.

..

.. date: 2022-07-01-00-01-22
.. gh-issue: 78707
.. nonce: fHGSuM
.. section: Library

Deprecate passing more than one positional argument to
:meth:`pathlib.PurePath.relative_to` and
:meth:`~pathlib.PurePath.is_relative_to`.

..

.. date: 2022-05-06-01-53-34
.. gh-issue: 92122
.. nonce: 96Lf2p
.. section: Library

Fix reStructuredText syntax errors in docstrings in the :mod:`enum` module.

..

.. date: 2022-04-23-08-12-14
.. gh-issue: 91851
.. nonce: Jd47V6
.. section: Library

Optimize the :class:`~fractions.Fraction` arithmetics for small components.

..

.. bpo: 24132
.. date: 2022-03-05-02-14-09
.. nonce: W6iORO
.. section: Library

Make :class:`pathlib.PurePath` and :class:`~pathlib.Path` subclassable
(private to start). Previously, attempting to instantiate a subclass
resulted in an :exc:`AttributeError` being raised. Patch by Barney Gale.

..

.. bpo: 40447
.. date: 2020-05-03-12-55-55
.. nonce: oKR0Lj
.. section: Library

Accept :class:`os.PathLike` (such as :class:`pathlib.Path`) in the
``stripdir`` arguments of :meth:`compileall.compile_file` and
:meth:`compileall.compile_dir`.

..

.. bpo: 36880
.. date: 2019-05-13-11-37-30
.. nonce: ZgBgH0
.. section: Library

Fix a reference counting issue when a :mod:`ctypes` callback with return
type :class:`~ctypes.py_object` returns ``None``, which could cause crashes.

..

.. date: 2022-12-30-00-42-23
.. gh-issue: 100616
.. nonce: eu80ij
.. section: Documentation

Document existing ``attr`` parameter to :func:`curses.window.vline` function
in :mod:`curses`.

..

.. date: 2022-12-23-21-42-26
.. gh-issue: 100472
.. nonce: NNixfO
.. section: Documentation

Remove claim in documentation that the ``stripdir``, ``prependdir`` and
``limit_sl_dest`` parameters of :func:`compileall.compile_dir` and
:func:`compileall.compile_file` could be :class:`bytes`.

..

.. bpo: 25377
.. date: 2020-06-17-14-47-48
.. nonce: CTxC6o
.. section: Documentation

Clarify use of octal format of mode argument in help(os.chmod) as well as
help(os.fchmod)

..

.. date: 2022-12-23-13-29-55
.. gh-issue: 100454
.. nonce: 3no0cW
.. section: Tests

Start running SSL tests with OpenSSL 3.1.0-beta1.

..

.. date: 2022-12-08-00-03-37
.. gh-issue: 100086
.. nonce: 1zYpto
.. section: Tests

The Python test runner (libregrtest) now logs Python build information like
"debug" vs "release" build, or LTO and PGO optimizations. Patch by Victor
Stinner.

..

.. date: 2022-06-16-13-26-31
.. gh-issue: 93018
.. nonce: wvNx76
.. section: Tests

Make two tests forgiving towards host system libexpat with backported
security fixes applied.

..

.. date: 2022-12-26-15-07-48
.. gh-issue: 100540
.. nonce: l6ToSY
.. section: Build

Removed the ``--with-system-ffi`` ``configure`` option; ``libffi`` must now
always be supplied by the system on all non-Windows platforms.  The option
has had no effect on non-Darwin platforms for several releases, and in 3.11
only had the non-obvious effect of invoking ``pkg-config`` to find
``libffi`` and never setting ``-DUSING_APPLE_OS_LIBFFI``.  Now on Darwin
platforms ``configure`` will first check for the OS ``libffi`` and then fall
back to the same processing as other platforms if it is not found.

..

.. date: 2022-12-08-14-00-04
.. gh-issue: 88267
.. nonce: MqtRbm
.. section: Build

Avoid exporting Python symbols in linked Windows applications when the core
is built as static.

..

.. bpo: 41916
.. date: 2022-03-04-10-47-23
.. nonce: 1d2GLU
.. section: Build

Allow override of ac_cv_cxx_thread so that cross compiled python can set
-pthread for CXX.

..

.. date: 2023-01-09-23-03-57
.. gh-issue: 100180
.. nonce: b5phrg
.. section: Windows

Update Windows installer to OpenSSL 1.1.1s

..

.. date: 2022-12-20-18-36-17
.. gh-issue: 99191
.. nonce: 0cfRja
.. section: Windows

Use ``_MSVC_LANG >= 202002L`` instead of less-precise ``_MSC_VER >=1929`` to
more accurately test for C++20 support in :file:`PC/_wmimodule.cpp`.

..

.. date: 2022-12-09-22-47-42
.. gh-issue: 79218
.. nonce: Yiot2e
.. section: Windows

Define ``MS_WIN64`` for Mingw-w64 64bit, fix cython compilation failure.

..

.. date: 2022-12-06-11-16-46
.. gh-issue: 99941
.. nonce: GmUQ6o
.. section: Windows

Ensure that :func:`asyncio.Protocol.data_received` receives an immutable
:class:`bytes` object (as documented), instead of :class:`bytearray`.

..

.. bpo: 43984
.. date: 2021-05-02-15-29-33
.. nonce: U92jiv
.. section: Windows

:meth:`winreg.SetValueEx` now leaves the target value untouched in the case
of conversion errors. Previously, ``-1`` would be written in case of such
errors.

..

.. bpo: 34816
.. date: 2021-04-08-00-36-37
.. nonce: 4Xe0id
.. section: Windows

``hasattr(ctypes.windll, 'nonexistant')`` now returns ``False`` instead of
raising :exc:`OSError`.

..

.. date: 2023-01-09-22-04-21
.. gh-issue: 100180
.. nonce: WVhCny
.. section: macOS

Update macOS installer to OpenSSL 1.1.1s

..

.. date: 2022-12-26-14-52-37
.. gh-issue: 100540
.. nonce: kYZLtX
.. section: macOS

Removed obsolete ``dlfcn.h`` shim from the ``_ctypes`` extension module,
which has not been necessary since Mac OS X 10.2.

..

.. bpo: 45256
.. date: 2022-12-29-19-22-11
.. nonce: a0ee_H
.. section: Tools/Demos

Fix a bug that caused an :exc:`AttributeError` to be raised in
``python-gdb.py`` when ``py-locals`` is used without a frame.

..

.. date: 2022-12-19-10-08-53
.. gh-issue: 100342
.. nonce: qDFlQG
.. section: Tools/Demos

Add missing ``NULL`` check for possible allocation failure in ``*args``
parsing in Argument Clinic.

..

.. date: 2022-12-02-09-31-19
.. gh-issue: 99947
.. nonce: Ski7OC
.. section: C API

Raising SystemError on import will now have its cause be set to the original
unexpected exception.

..

.. date: 2022-11-30-16-39-22
.. gh-issue: 99240
.. nonce: 67nAX-
.. section: C API

In argument parsing, after deallocating newly allocated memory, reset its
pointer to NULL.

..

.. date: 2022-11-04-16-13-35
.. gh-issue: 98724
.. nonce: p0urWO
.. section: C API

The :c:macro:`Py_CLEAR`, :c:macro:`Py_SETREF` and :c:macro:`Py_XSETREF`
macros now only evaluate their arguments once. If an argument has side
effects, these side effects are no longer duplicated. Patch by Victor
Stinner.


================================================
File: /Misc/NEWS.d/3.12.0a5.rst
================================================
.. date: 2022-11-08-12-06-52
.. gh-issue: 99108
.. nonce: 4Wrsuh
.. release date: 2023-02-07
.. section: Security

Replace the builtin :mod:`hashlib` implementations of SHA2-224 and SHA2-256
originally from LibTomCrypt with formally verified, side-channel resistant
code from the `HACL* <https://github.com/hacl-star/hacl-star/>`_ project.
The builtins remain a fallback only used when OpenSSL does not provide them.

..

.. date: 2023-02-06-20-13-36
.. gh-issue: 92173
.. nonce: RQE0mk
.. section: Core and Builtins

Fix the ``defs`` and ``kwdefs`` arguments to :c:func:`PyEval_EvalCodeEx` and
a reference leak in that function.

..

.. date: 2023-01-30-11-56-09
.. gh-issue: 59956
.. nonce: 7xqnC_
.. section: Core and Builtins

The GILState API is now partially compatible with subinterpreters.
Previously, ``PyThreadState_GET()`` and ``PyGILState_GetThisThreadState()``
would get out of sync, causing inconsistent behavior and crashes.

..

.. date: 2023-01-30-08-59-47
.. gh-issue: 101400
.. nonce: Di_ZFm
.. section: Core and Builtins

Fix wrong lineno in exception message on :keyword:`continue` or
:keyword:`break` which are not in a loop. Patch by Donghee Na.

..

.. date: 2023-01-28-20-31-42
.. gh-issue: 101372
.. nonce: 8BcpCC
.. section: Core and Builtins

Fix :func:`~unicodedata.is_normalized` to properly handle the UCD 3.2.0
cases. Patch by Donghee Na.

..

.. date: 2023-01-28-13-11-52
.. gh-issue: 101266
.. nonce: AxV3OF
.. section: Core and Builtins

Fix :func:`sys.getsizeof` reporting for :class:`int` subclasses.

..

.. date: 2023-01-24-17-13-32
.. gh-issue: 101291
.. nonce: Yr6u_c
.. section: Core and Builtins

Refactor the ``PyLongObject`` struct into a normal Python object header and
a ``PyLongValue`` struct.

..

.. date: 2023-01-15-03-26-04
.. gh-issue: 101046
.. nonce: g2CM4S
.. section: Core and Builtins

Fix a possible memory leak in the parser when raising :exc:`MemoryError`.
Patch by Pablo Galindo

..

.. date: 2023-01-14-17-03-08
.. gh-issue: 101037
.. nonce: 9ATNuf
.. section: Core and Builtins

Fix potential memory underallocation issue for instances of :class:`int`
subclasses with value zero.

..

.. date: 2023-01-13-12-56-20
.. gh-issue: 100762
.. nonce: YvHaQJ
.. section: Core and Builtins

Record the (virtual) exception block depth in the oparg of
:opcode:`YIELD_VALUE`. Use this to avoid the expensive ``throw()`` when
closing generators (and coroutines) that can be closed trivially.

..

.. date: 2023-01-12-13-46-49
.. gh-issue: 100982
.. nonce: mJ234s
.. section: Core and Builtins

Adds a new :opcode:`COMPARE_AND_BRANCH` instruction. This is a bit more
efficient when performing a comparison immediately followed by a branch, and
restores the design intent of PEP 659 that specializations are local to a
single instruction.

..

.. date: 2023-01-11-22-52-19
.. gh-issue: 100942
.. nonce: ontOy_
.. section: Core and Builtins

Fixed segfault in property.getter/setter/deleter that occurred when a
property subclass overrode the ``__new__`` method to return a non-property
instance.

..

.. date: 2023-01-10-16-59-33
.. gh-issue: 100923
.. nonce: ypJAX-
.. section: Core and Builtins

Remove the ``mask`` cache entry for the :opcode:`COMPARE_OP` instruction and
embed the mask into the oparg.

..

.. date: 2023-01-10-14-11-17
.. gh-issue: 100892
.. nonce: qfBVYI
.. section: Core and Builtins

Fix race while iterating over thread states in clearing
:class:`threading.local`. Patch by Kumar Aditya.

..

.. date: 2023-01-06-09-22-21
.. gh-issue: 91351
.. nonce: iq2vZ_
.. section: Core and Builtins

Fix a case where re-entrant imports could corrupt the import deadlock
detection code and cause a :exc:`KeyError` to be raised out of
:mod:`importlib/_bootstrap`.  In addition to the straightforward cases, this
could also happen when garbage collection leads to a warning being emitted
-- as happens when it collects an open socket or file)

..

.. date: 2023-01-03-20-59-20
.. gh-issue: 100726
.. nonce: W9huFl
.. section: Core and Builtins

Optimize construction of ``range`` object for medium size integers.

..

.. date: 2023-01-03-14-33-23
.. gh-issue: 100712
.. nonce: po6xyB
.. section: Core and Builtins

Added option to build cpython with specialization disabled, by setting
``ENABLE_SPECIALIZATION=False`` in :mod:`opcode`, followed by ``make
regen-all``.

..

.. bpo: 32780
.. date: 2018-02-05-21-54-46
.. nonce: Dtiz8z
.. section: Core and Builtins

Inter-field padding is now inserted into the PEP3118 format strings obtained
from :class:`ctypes.Structure` objects, reflecting their true representation
in memory.

..

.. date: 2023-02-05-14-39-49
.. gh-issue: 101541
.. nonce: Mo3ppp
.. section: Library

[Enum] - fix psuedo-flag creation

..

.. date: 2023-02-04-21-01-49
.. gh-issue: 101570
.. nonce: lbtUsD
.. section: Library

Upgrade pip wheel bundled with ensurepip (pip 23.0)

..

.. date: 2023-01-26-06-44-35
.. gh-issue: 101323
.. nonce: h8Hk11
.. section: Library

Fix a bug where errors where not thrown by zlib._ZlibDecompressor if
encountered during decompressing.

..

.. date: 2023-01-26-01-25-56
.. gh-issue: 101317
.. nonce: vWaS1x
.. section: Library

Add *ssl_shutdown_timeout* parameter for
:meth:`asyncio.StreamWriter.start_tls`.

..

.. date: 2023-01-25-18-07-20
.. gh-issue: 101326
.. nonce: KL4SFv
.. section: Library

Fix regression when passing ``None`` as second or third argument to
``FutureIter.throw``.

..

.. date: 2023-01-24-12-53-59
.. gh-issue: 92123
.. nonce: jf6TO5
.. section: Library

Adapt the ``_elementtree`` extension module to multi-phase init
(:pep:`489`). Patches by Erlend E. Aasland.

..

.. date: 2023-01-21-16-50-22
.. gh-issue: 100795
.. nonce: NPMZf7
.. section: Library

Avoid potential unexpected ``freeaddrinfo`` call (double free) in
:mod:`socket` when when a libc ``getaddrinfo()`` implementation leaves
garbage in an output pointer when returning an error. Original patch by
Sergey G. Brester.

..

.. date: 2023-01-20-10-46-59
.. gh-issue: 101143
.. nonce: hJo8hu
.. section: Library

Remove unused references to :class:`~asyncio.TimerHandle` in
``asyncio.base_events.BaseEventLoop._add_callback``.

..

.. date: 2023-01-18-17-58-50
.. gh-issue: 101144
.. nonce: FHd8Un
.. section: Library

Make :func:`zipfile.Path.open` and :func:`zipfile.Path.read_text` also
accept ``encoding`` as a positional argument. This was the behavior in
Python 3.9 and earlier.  3.10 introduced a regression where supplying it as
a positional argument would lead to a :exc:`TypeError`.

..

.. date: 2023-01-15-09-11-30
.. gh-issue: 94518
.. nonce: jvxtxm
.. section: Library

Group-related variables of ``_posixsubprocess`` module are renamed to stress
that supplementary group affinity is added to a fork, not replace the
inherited ones. Patch by Oleg Iarygin.

..

.. date: 2023-01-14-12-58-21
.. gh-issue: 101015
.. nonce: stWFid
.. section: Library

Fix :func:`typing.get_type_hints` on ``'*tuple[...]'`` and ``*tuple[...]``.
It must not drop the ``Unpack`` part.

..

.. date: 2023-01-12-21-22-20
.. gh-issue: 101000
.. nonce: wz4Xgc
.. section: Library

Add :func:`os.path.splitroot`, which splits a path into a 3-item tuple
``(drive, root, tail)``. This new function is used by :mod:`pathlib` to
improve the performance of path construction by up to a third.

..

.. date: 2023-01-12-01-18-13
.. gh-issue: 100573
.. nonce: KDskqo
.. section: Library

Fix a Windows :mod:`asyncio` bug with named pipes where a client doing
``os.stat()`` on the pipe would cause an error in the server that disabled
serving future requests.

..

.. date: 2023-01-08-00-12-44
.. gh-issue: 39615
.. nonce: gn4PhB
.. section: Library

:func:`warnings.warn` now has the ability to skip stack frames based on code
filename prefix rather than only a numeric ``stacklevel`` via the new
``skip_file_prefixes`` keyword argument.

..

.. date: 2023-01-04-14-42-59
.. gh-issue: 100750
.. nonce: iFJs5Y
.. section: Library

pass encoding kwarg to subprocess in platform

..

.. date: 2022-12-21-17-49-50
.. gh-issue: 100160
.. nonce: N0NHRj
.. section: Library

Emit a deprecation warning in
:meth:`asyncio.DefaultEventLoopPolicy.get_event_loop` if there is no current
event loop set and it decides to create one.

..

.. date: 2022-12-19-23-19-26
.. gh-issue: 96290
.. nonce: qFjsi6
.. section: Library

Fix handling of partial and invalid UNC drives in ``ntpath.splitdrive()``,
and in ``ntpath.normpath()`` on non-Windows systems. Paths such as
'\\server' and '\\' are now considered by ``splitdrive()`` to contain only a
drive, and consequently are not modified by ``normpath()`` on non-Windows
systems. The behaviour of ``normpath()`` on Windows systems is unaffected,
as native OS APIs are used. Patch by Eryk Sun, with contributions by Barney
Gale.

..

.. date: 2022-12-11-14-38-59
.. gh-issue: 99952
.. nonce: IYGLzr
.. section: Library

Fix a reference undercounting issue in :class:`ctypes.Structure` with
``from_param()`` results larger than a C pointer.

..

.. date: 2022-12-10-15-30-17
.. gh-issue: 67790
.. nonce: P9YUZM
.. section: Library

Add float-style formatting support for :class:`fractions.Fraction`
instances.

..

.. date: 2022-11-24-21-52-31
.. gh-issue: 99266
.. nonce: 88GcV9
.. section: Library

Preserve more detailed error messages in :mod:`ctypes`.

..

.. date: 2022-11-15-23-30-39
.. gh-issue: 86682
.. nonce: gK9i1N
.. section: Library

Ensure runtime-created collections have the correct module name using the
newly added (internal) :func:`sys._getframemodulename`.

..

.. date: 2022-11-14-03-06-03
.. gh-issue: 88597
.. nonce: EYJA-Q
.. section: Library

:mod:`uuid` now has a command line interface. Try ``python -m uuid -h``.

..

.. date: 2022-09-26-21-18-47
.. gh-issue: 60580
.. nonce: 0hBgde
.. section: Library

:data:`ctypes.wintypes.BYTE` definition changed from :data:`~ctypes.c_byte`
to :data:`~ctypes.c_ubyte` to match Windows SDK. Patch by Anatoly Techtonik
and Oleg Iarygin.

..

.. date: 2022-07-22-13-38-37
.. gh-issue: 94518
.. nonce: _ZP0cz
.. section: Library

``_posixsubprocess`` now initializes all UID and GID variables using a
reserved ``-1`` value instead of a separate flag. Patch by Oleg Iarygin.

..

.. bpo: 38941
.. date: 2022-02-05-12-01-58
.. nonce: 8IhvyG
.. section: Library

The :mod:`xml.etree.ElementTree` module now emits :exc:`DeprecationWarning`
when testing the truth value of an :class:`xml.etree.ElementTree.Element`.
Before, the Python implementation emitted :exc:`FutureWarning`, and the C
implementation emitted nothing.

..

.. bpo: 40077
.. date: 2020-11-20-21-06-08
.. nonce: M-iZq3
.. section: Library

Convert :mod:`elementtree` types to heap types. Patch by Erlend E. Aasland.

..

.. bpo: 29847
.. date: 2020-04-18-17-45-03
.. nonce: Uxtbq0
.. section: Library

Fix a bug where :class:`pathlib.Path` accepted and ignored keyword
arguments. Patch provided by Yurii Karabas.

..

.. date: 2018-05-21-17-18-00
.. gh-issue: 77772
.. nonce: Fhg84L
.. section: Library

:class:`ctypes.CDLL`, :class:`ctypes.OleDLL`, :class:`ctypes.WinDLL`, and
:class:`ctypes.PyDLL` now accept :term:`path-like objects <path-like
object>` as their ``name`` argument. Patch by Robert Hoelzl.

..

.. date: 2022-06-19-22-04-47
.. gh-issue: 88324
.. nonce: GHhSQ1
.. section: Documentation

Reword :mod:`subprocess` to emphasize default behavior of *stdin*, *stdout*,
and *stderr* arguments. Remove inaccurate statement about child file handle
inheritance.

..

.. date: 2023-02-04-17-24-33
.. gh-issue: 101334
.. nonce: _yOqwg
.. section: Tests

``test_tarfile`` has been updated to pass when run as a high UID.

..

.. date: 2023-02-04-06-59-07
.. gh-issue: 101282
.. nonce: 7sQz5l
.. section: Build

Update BOLT configuration not to use deprecated usage of ``--split
functions``. Patch by Donghee Na.

..

.. date: 2023-02-02-23-43-46
.. gh-issue: 101522
.. nonce: lnUDta
.. section: Build

Allow overriding Windows dependencies versions and paths using MSBuild
properties.

..

.. date: 2023-01-26-19-02-11
.. gh-issue: 77532
.. nonce: cXD8bg
.. section: Build

Minor fixes to allow building with ``PlatformToolset=ClangCL`` on Windows.

..

.. date: 2023-01-21-10-31-35
.. gh-issue: 101152
.. nonce: xvM8pL
.. section: Build

In accordance with :PEP:`699`, the ``ma_version_tag`` field in
:c:type:`PyDictObject` is deprecated for extension modules. Accessing this
field will generate a compiler warning at compile time. This field will be
removed in Python 3.14.

..

.. date: 2023-01-17-21-32-51
.. gh-issue: 100340
.. nonce: i9zRGM
.. section: Build

Allows -Wno-int-conversion for wasm-sdk 17 and onwards, thus enables
building WASI builds once against the latest sdk.

..

.. date: 2023-01-15-11-22-15
.. gh-issue: 101060
.. nonce: 0mYk9E
.. section: Build

Conditionally add ``-fno-reorder-blocks-and-partition`` in configure.
Effectively fixes ``--enable-bolt`` when using Clang, as this appears to be
a GCC-only flag.

..

.. date: 2022-10-27-09-57-12
.. gh-issue: 98705
.. nonce: H11XmR
.. section: Build

``__bool__`` is defined in AIX system header files which breaks the build in
AIX, so undefine it.

..

.. date: 2022-10-25-11-53-55
.. gh-issue: 98636
.. nonce: e0RPAr
.. section: Build

Fix a regression in detecting ``gdbm_compat`` library for the ``_gdbm``
module build.

..

.. date: 2022-08-30-10-16-31
.. gh-issue: 96305
.. nonce: 274i8B
.. section: Build

``_aix_support`` now uses a simple code to get platform details rather than
the now non-existent ``_bootsubprocess`` during bootstrap.

..

.. date: 2023-02-03-17-53-06
.. gh-issue: 101543
.. nonce: cORAT4
.. section: Windows

Ensure the install path in the registry is only used when the standard
library hasn't been located in any other way.

..

.. date: 2023-01-31-16-50-07
.. gh-issue: 101467
.. nonce: ye9t-L
.. section: Windows

The ``py.exe`` launcher now correctly filters when only a single runtime is
installed. It also correctly handles prefix matches on tags so that ``-3.1``
does not match ``3.11``, but would still match ``3.1-32``.

..

.. date: 2023-01-25-00-23-31
.. gh-issue: 99834
.. nonce: WN41lc
.. section: Windows

Updates bundled copy of Tcl/Tk to 8.6.13.0

..

.. date: 2023-01-18-18-25-18
.. gh-issue: 101135
.. nonce: HF9VlG
.. section: Windows

Restore ability to launch older 32-bit versions from the :file:`py.exe`
launcher when both 32-bit and 64-bit installs of the same version are
available.

..

.. date: 2023-01-17-18-17-58
.. gh-issue: 82052
.. nonce: mWyysT
.. section: Windows

Fixed an issue where writing more than 32K of Unicode output to the console
screen in one go can result in mojibake.

..

.. date: 2023-01-11-16-28-09
.. gh-issue: 100320
.. nonce: 2DU2it
.. section: Windows

Ensures the ``PythonPath`` registry key from an install is used when
launching from a different copy of Python that relies on an existing install
to provide a copy of its modules and standard library.

..

.. date: 2023-01-11-14-42-11
.. gh-issue: 100247
.. nonce: YfEmSz
.. section: Windows

Restores support for the :file:`py.exe` launcher finding shebang commands in
its configuration file using the full command name.


================================================
File: /Misc/NEWS.d/3.12.0a6.rst
================================================
.. date: 2023-02-17-10-42-48
.. gh-issue: 99108
.. nonce: MKA8-f
.. release date: 2023-03-07
.. section: Security

Replace builtin hashlib implementations of MD5 and SHA1 with verified ones
from the HACL* project.

..

.. date: 2023-02-08-22-03-04
.. gh-issue: 101727
.. nonce: 9P5eZz
.. section: Security

Updated the OpenSSL version used in Windows and macOS binary release builds
to 1.1.1t to address :cve:`2023-0286`, :cve:`2022-4303`, and :cve:`2022-4303` per
`the OpenSSL 2023-02-07 security advisory
<https://openssl-library.org/news/secadv/20230207.txt>`_.

..

.. date: 2023-02-08-12-57-35
.. gh-issue: 99108
.. nonce: 6tnmhA
.. section: Security

Replace the builtin :mod:`hashlib` implementations of SHA2-384 and SHA2-512
originally from LibTomCrypt with formally verified, side-channel resistant
code from the `HACL* <https://github.com/hacl-star/hacl-star/>`_ project.
The builtins remain a fallback only used when OpenSSL does not provide them.

..

.. date: 2023-01-24-16-12-00
.. gh-issue: 101283
.. nonce: 9tqu39
.. section: Security

:class:`subprocess.Popen` now uses a safer approach to find ``cmd.exe`` when
launching with ``shell=True``. Patch by Eryk Sun, based on a patch by Oleg
Iarygin.

..

.. date: 2023-03-07-16-56-28
.. gh-issue: 102493
.. nonce: gTXrcD
.. section: Core and Builtins

Fix regression in semantics of normalisation in ``PyErr_SetObject``.

..

.. date: 2023-03-06-13-05-33
.. gh-issue: 102416
.. nonce: dz6K5f
.. section: Core and Builtins

Do not memoize incorrectly automatically generated loop rules in the parser.
Patch by Pablo Galindo.

..

.. date: 2023-03-04-20-56-12
.. gh-issue: 102356
.. nonce: 07KvUd
.. section: Core and Builtins

Fix a bug that caused a crash when deallocating deeply nested filter
objects. Patch by Marta Gómez Macías.

..

.. date: 2023-02-28-21-17-03
.. gh-issue: 102336
.. nonce: -wL3Tm
.. section: Core and Builtins

Cleanup Windows 7 specific special handling. Patch by Max Bachmann.

..

.. date: 2023-02-26-23-10-32
.. gh-issue: 102250
.. nonce: 7MUKoC
.. section: Core and Builtins

Fixed a segfault occurring when the interpreter calls a ``__bool__`` method
that raises.

..

.. date: 2023-02-24-17-59-39
.. gh-issue: 102126
.. nonce: HTT8Vc
.. section: Core and Builtins

Fix deadlock at shutdown when clearing thread states if any finalizer tries
to acquire the runtime head lock. Patch by Kumar Aditya.

..

.. date: 2023-02-22-15-15-32
.. gh-issue: 102027
.. nonce: Km4G-d
.. section: Core and Builtins

Use ``GetCurrentProcessId`` on Windows when ``getpid`` is unavailable. Patch
by Max Bachmann.

..

.. date: 2023-02-20-15-18-33
.. gh-issue: 102056
.. nonce: uHKuwH
.. section: Core and Builtins

Fix error handling bugs in interpreter's exception printing code, which
could cause a crash on infinite recursion.

..

.. date: 2023-02-17-10-12-13
.. gh-issue: 100982
.. nonce: mJGJQw
.. section: Core and Builtins

Restrict the scope of the :opcode:`FOR_ITER_RANGE` instruction to the scope
of the original :opcode:`FOR_ITER` instruction, to allow instrumentation.

..

.. date: 2023-02-16-23-19-01
.. gh-issue: 101967
.. nonce: Kqr1dz
.. section: Core and Builtins

Fix possible segfault in ``positional_only_passed_as_keyword`` function,
when new list created.

..

.. date: 2023-02-16-16-57-23
.. gh-issue: 101952
.. nonce: Zo1dlq
.. section: Core and Builtins

Fix possible segfault in ``BUILD_SET`` opcode, when new set created.

..

.. date: 2023-02-13-22-21-58
.. gh-issue: 74895
.. nonce: esMNtq
.. section: Core and Builtins

:mod:`socket.getaddrinfo` no longer raises :class:`OverflowError` for
:class:`int` **port** values outside of the C long range. Out of range
values are left up to the underlying string based C library API to report. A
:class:`socket.gaierror` ``SAI_SERVICE`` may occur instead, or no error at
all as not all platform C libraries generate an error.

..

.. date: 2023-02-13-18-21-14
.. gh-issue: 101799
.. nonce: wpHbCn
.. section: Core and Builtins

Add :opcode:`CALL_INTRINSIC_2` and use it instead of
:opcode:`!PREP_RERAISE_STAR`.

..

.. date: 2023-02-12-22-40-22
.. gh-issue: 101857
.. nonce: _bribG
.. section: Core and Builtins

Fix xattr support detection on Linux systems by widening the check to linux,
not just glibc. This fixes support for musl.

..

.. date: 2023-02-11-23-14-06
.. gh-issue: 84783
.. nonce: _P5sMa
.. section: Core and Builtins

Make the slice object hashable. Patch by Will Bradshaw and Furkan Onder.

..

.. date: 2023-02-10-15-54-57
.. gh-issue: 87849
.. nonce: IUVvPz
.. section: Core and Builtins

Change the ``SEND`` instruction to leave the receiver on the stack. This
allows the specialized form of ``SEND`` to skip the chain of C calls and
jump directly to the ``RESUME`` in the generator or coroutine.

..

.. date: 2023-02-10-07-21-47
.. gh-issue: 101765
.. nonce: MO5LlC
.. section: Core and Builtins

Fix SystemError / segmentation fault in iter ``__reduce__`` when internal
access of ``builtins.__dict__`` keys mutates the iter object.

..

.. date: 2023-02-10-01-15-57
.. gh-issue: 101430
.. nonce: T3Gegb
.. section: Core and Builtins

Update :mod:`tracemalloc` to handle presize of object properly. Patch by
Donghee Na.

..

.. date: 2023-02-08-17-13-31
.. gh-issue: 101696
.. nonce: seJhTt
.. section: Core and Builtins

Invalidate type version tag in ``_PyStaticType_Dealloc`` for static types,
avoiding bug where a false cache hit could crash the interpreter. Patch by
Kumar Aditya.

..

.. date: 2023-02-07-14-56-43
.. gh-issue: 101632
.. nonce: Fd1yxk
.. section: Core and Builtins

Adds a new :opcode:`RETURN_CONST` instruction.

..

.. date: 2023-01-04-12-49-33
.. gh-issue: 100719
.. nonce: uRPccL
.. section: Core and Builtins

Remove gi_code field from generator (and coroutine and async generator)
objects as it is redundant. The frame already includes a reference to the
code object.

..

.. date: 2022-11-02-20-23-47
.. gh-issue: 98627
.. nonce: VJkdRM
.. section: Core and Builtins

When an interpreter is configured to check (and only then), importing an
extension module will now fail when the extension does not support multiple
interpreters (i.e. doesn't implement PEP 489 multi-phase init). This does
not apply to the main interpreter, nor to subinterpreters created with
``Py_NewInterpreter()``.

..

.. date: 2023-03-04-14-46-47
.. gh-issue: 102302
.. nonce: -b_s6Z
.. section: Library

Micro-optimise hashing of :class:`inspect.Parameter`, reducing the time it
takes to hash an instance by around 40%.

..

.. date: 2023-02-28-09-52-25
.. gh-issue: 101979
.. nonce: or3hXV
.. section: Library

Fix a bug where parentheses in the ``metavar`` argument to
:meth:`argparse.ArgumentParser.add_argument` were dropped. Patch by Yeojin
Kim.

..

.. date: 2023-02-26-12-37-17
.. gh-issue: 91038
.. nonce: S4rFH_
.. section: Library

:meth:`platform.platform` now has boolean default arguments.

..

.. date: 2023-02-23-20-39-52
.. gh-issue: 81652
.. nonce: Vxz0Mr
.. section: Library

Add :const:`mmap.MAP_ALIGNED_SUPER` FreeBSD and :const:`mmap.MAP_CONCEAL`
OpenBSD constants to :mod:`mmap`. Patch by Yeojin Kim.

..

.. date: 2023-02-23-15-06-01
.. gh-issue: 102179
.. nonce: P6KQ4c
.. section: Library

Fix :func:`os.dup2` error message for negative fds.

..

.. date: 2023-02-21-10-05-33
.. gh-issue: 101961
.. nonce: 7e56jh
.. section: Library

For the binary mode, :func:`fileinput.hookcompressed` doesn't set the
``encoding`` value even if the value is ``None``. Patch by Gihwan Kim.

..

.. date: 2023-02-21-07-15-41
.. gh-issue: 101936
.. nonce: QVOxHH
.. section: Library

The default value of ``fp`` becomes :class:`io.BytesIO` if
:exc:`~urllib.error.HTTPError` is initialized without a designated ``fp``
parameter. Patch by Long Vo.

..

.. date: 2023-02-17-20-24-15
.. gh-issue: 101566
.. nonce: FjgWBt
.. section: Library

In zipfile, sync Path with `zipp 3.14
<https://zipp.readthedocs.io/en/latest/history.html#v3-14-0>`_, including
fix for extractall on the underlying zipfile after being wrapped in
``Path``.

..

.. date: 2023-02-17-19-00-58
.. gh-issue: 97930
.. nonce: C_nQjb
.. section: Library

Apply changes from `importlib_resources 5.12
<https://importlib-resources.readthedocs.io/en/latest/history.html#v5-12-0>`_,
including fix for ``MultiplexedPath`` to support directories in multiple
namespaces (python/importlib_resources#265).

..

.. date: 2023-02-17-18-44-27
.. gh-issue: 101997
.. nonce: A6_blD
.. section: Library

Upgrade pip wheel bundled with ensurepip (pip 23.0.1)

..

.. date: 2023-02-15-01-54-06
.. gh-issue: 99108
.. nonce: rjTSic
.. section: Library

The built-in extension modules for :mod:`hashlib` SHA2 algorithms, used when
OpenSSL does not provide them, now live in a single internal ``_sha2``
module instead of separate ``_sha256`` and ``_sha512`` modules.

..

.. date: 2023-02-14-09-08-48
.. gh-issue: 101892
.. nonce: FMos8l
.. section: Library

Callable iterators no longer raise :class:`SystemError` when the callable
object exhausts the iterator but forgets to either return a sentinel value
or raise :class:`StopIteration`.

..

.. date: 2023-02-13-12-55-48
.. gh-issue: 87634
.. nonce: q-SBhJ
.. section: Library

Remove locking behavior from :func:`functools.cached_property`.

..

.. date: 2023-02-11-13-23-29
.. gh-issue: 97786
.. nonce: QjvQ1B
.. section: Library

Fix potential undefined behaviour in corner cases of floating-point-to-time
conversions.

..

.. date: 2023-02-10-16-02-29
.. gh-issue: 101517
.. nonce: r7S2u8
.. section: Library

Fixed bug where :mod:`bdb` looks up the source line with :mod:`linecache`
with a ``lineno=None``, which causes it to fail with an unhandled exception.

..

.. date: 2023-02-10-11-59-13
.. gh-issue: 101773
.. nonce: J_kI7y
.. section: Library

Optimize :class:`fractions.Fraction` for small components. The private
argument ``_normalize`` of the :class:`fractions.Fraction` constructor has
been removed.

..

.. date: 2023-02-08-18-20-58
.. gh-issue: 101693
.. nonce: 4_LPXj
.. section: Library

In :meth:`sqlite3.Cursor.execute`, :exc:`DeprecationWarning` is now emitted
when :ref:`named placeholders <sqlite3-placeholders>` are used together with
parameters supplied as a :term:`sequence` instead of as a :class:`dict`.
Starting from Python 3.14, using named placeholders with parameters supplied
as a sequence will raise a :exc:`~sqlite3.ProgrammingError`. Patch by Erlend
E. Aasland.

..

.. date: 2023-02-07-22-21-46
.. gh-issue: 101446
.. nonce: -c0FdK
.. section: Library

Change repr of :class:`collections.OrderedDict` to use regular dictionary
formatting instead of pairs of keys and values.

..

.. date: 2023-02-07-22-20-32
.. gh-issue: 101362
.. nonce: Jlk6mt
.. section: Library

Speed up :class:`pathlib.PurePath` construction by handling arguments more
uniformly. When a :class:`pathlib.Path` argument is supplied, we use its
string representation rather than joining its parts with
:func:`os.path.join`.

..

.. date: 2023-02-07-21-16-41
.. gh-issue: 101362
.. nonce: KMQllM
.. section: Library

Speed up :class:`pathlib.PurePath` construction by calling
:func:`os.path.join` only when two or more arguments are given.

..

.. date: 2023-02-07-20-46-08
.. gh-issue: 101362
.. nonce: 2ckZ6R
.. section: Library

Speed up :class:`pathlib.Path` construction by running the path flavour
compatibility check only when pathlib is imported.

..

.. date: 2023-02-05-21-40-15
.. gh-issue: 85984
.. nonce: Kfzbb2
.. section: Library

Refactored the implementation of :func:`pty.fork` to use
:func:`os.login_tty`.

A :exc:`DeprecationWarning` is now raised by ``pty.master_open()`` and
``pty.slave_open()``. They were undocumented and deprecated long long ago in
the docstring in favor of :func:`pty.openpty`.

..

.. date: 2023-02-04-16-35-46
.. gh-issue: 101561
.. nonce: Xo6pIZ
.. section: Library

Add a new decorator :func:`typing.override`. See :pep:`698` for details.
Patch by Steven Troxler.

..

.. date: 2023-02-01-10-42-16
.. gh-issue: 63301
.. nonce: XNxSFh
.. section: Library

Set exit code when :mod:`tabnanny` CLI exits on error.

..

.. date: 2023-01-27-02-53-50
.. gh-issue: 101360
.. nonce: bPB7SL
.. section: Library

Fix anchor matching in :meth:`pathlib.PureWindowsPath.match`. Path and
pattern anchors are now matched with :mod:`fnmatch`, just like other path
parts. This allows patterns such as ``"*:/Users/*"`` to be matched.

..

.. date: 2023-01-25-00-14-52
.. gh-issue: 101277
.. nonce: FceHX7
.. section: Library

Remove global state from :mod:`itertools` module (:pep:`687`). Patches by
Erlend E. Aasland.

..

.. date: 2023-01-06-21-14-41
.. gh-issue: 100809
.. nonce: I697UT
.. section: Library

Fix handling of drive-relative paths (like 'C:' and 'C:foo') in
:meth:`pathlib.Path.absolute`. This method now uses the OS API to retrieve
the correct current working directory for the drive.

..

.. date: 2023-01-02-22-41-44
.. gh-issue: 99138
.. nonce: 17hp9U
.. section: Library

Apply :pep:`687` to :mod:`zoneinfo`. Patch by Erlend E. Aasland.

..

.. date: 2022-10-22-09-26-43
.. gh-issue: 96764
.. nonce: Dh9Y5L
.. section: Library

:func:`asyncio.wait_for` now uses :func:`asyncio.timeout` as its underlying
implementation. Patch by Kumar Aditya.

..

.. date: 2022-09-05-12-17-34
.. gh-issue: 88233
.. nonce: gff9qJ
.. section: Library

Correctly preserve "extra" fields in ``zipfile`` regardless of their
ordering relative to a zip64 "extra."

..

.. bpo: 23224
.. date: 2018-06-20-09-12-21
.. nonce: zxCQ13
.. section: Library

Fix segfaults when creating :class:`lzma.LZMADecompressor` and
:class:`bz2.BZ2Decompressor` objects without calling ``__init__()``, and fix
leakage of locks and internal buffers when calling the ``__init__()``
methods of :class:`lzma.LZMADecompressor`, :class:`lzma.LZMACompressor`,
:class:`bz2.BZ2Compressor`, and :class:`bz2.BZ2Decompressor` objects
multiple times.

..

.. date: 2023-02-19-10-33-01
.. gh-issue: 85417
.. nonce: kYO8u3
.. section: Documentation

Update :mod:`cmath` documentation to clarify behaviour on branch cuts.

..

.. date: 2023-02-07-21-43-24
.. gh-issue: 97725
.. nonce: cuY7Cd
.. section: Documentation

Fix :meth:`asyncio.Task.print_stack` description for ``file=None``. Patch by
Oleg Iarygin.

..

.. date: 2023-02-18-10-51-02
.. gh-issue: 102019
.. nonce: 0797SJ
.. section: Tests

Fix deadlock on shutdown if ``test_current_{exception,frames}`` fails. Patch
by Jacob Bower.

..

.. date: 2023-02-11-22-36-10
.. gh-issue: 85984
.. nonce: EVXjT9
.. section: Tests

Utilize new "winsize" functions from termios in pty tests.

..

.. date: 2023-02-11-20-28-08
.. gh-issue: 89792
.. nonce: S-Y5BZ
.. section: Tests

``test_tools`` now copies up to 10x less source data to a temporary
directory during the ``freeze`` test by ignoring git metadata and other
artifacts.  It also limits its python build parallelism based on
os.cpu_count instead of hard coding it as 8 cores.

..

.. date: 2023-01-12-00-49-16
.. gh-issue: 99942
.. nonce: DUR8b4
.. section: Build

On Android, in a static build, python-config in embed mode no longer
incorrectly reports a library to link to.

..

.. date: 2022-12-20-01-06-17
.. gh-issue: 99942
.. nonce: lbmzYj
.. section: Build

On Android, python.pc now correctly reports the library to link to, the same
as python-config.sh.

..

.. date: 2022-12-18-08-33-28
.. gh-issue: 100221
.. nonce: K94Ct3
.. section: Build

Fix creating install directories in ``make sharedinstall`` if they exist
outside ``DESTDIR`` already.

..

.. date: 2022-09-14-10-38-15
.. gh-issue: 96821
.. nonce: Zk2a9c
.. section: Build

Explicitly mark C extension modules that need defined signed integer
overflow, and add a configure option :option:`--with-strict-overflow`. Patch
by Matthias Görgens and Shantanu Jain.

..

.. date: 2023-03-01-01-36-39
.. gh-issue: 102344
.. nonce: Dgfux4
.. section: Windows

Implement ``winreg.QueryValue`` using ``QueryValueEx`` and
``winreg.SetValue`` using ``SetValueEx``. Patch by Max Bachmann.

..

.. date: 2023-02-15-11-08-10
.. gh-issue: 101881
.. nonce: fScr3m
.. section: Windows

Handle read and write operations on non-blocking pipes properly on Windows.

..

.. date: 2023-02-13-18-05-49
.. gh-issue: 101881
.. nonce: _TnHzN
.. section: Windows

Add support for the os.get_blocking() and os.set_blocking() functions on
Windows.

..

.. date: 2023-02-13-16-32-50
.. gh-issue: 101849
.. nonce: 7lm_53
.. section: Windows

Ensures installer will correctly upgrade existing ``py.exe`` launcher
installs.

..

.. date: 2023-02-10-14-26-05
.. gh-issue: 101763
.. nonce: RPaj7r
.. section: Windows

Updates copy of libffi bundled with Windows installs to 3.4.4.

..

.. date: 2023-02-09-22-09-27
.. gh-issue: 101759
.. nonce: zFlqSH
.. section: Windows

Update Windows installer to SQLite 3.40.1.

..

.. date: 2023-02-07-18-22-54
.. gh-issue: 101614
.. nonce: NjVP0n
.. section: Windows

Correctly handle extensions built against debug binaries that reference
``python3_d.dll``.

..

.. date: 2023-01-25-11-33-54
.. gh-issue: 101196
.. nonce: wAX_2g
.. section: Windows

The functions ``os.path.isdir``, ``os.path.isfile``, ``os.path.islink`` and
``os.path.exists`` are now 13% to 28% faster on Windows, by making fewer
Win32 API calls.

..

.. date: 2023-02-09-22-07-17
.. gh-issue: 101759
.. nonce: B0JP2H
.. section: macOS

Update macOS installer to SQLite 3.40.1.

..

.. date: 2023-02-14-15-53-01
.. gh-issue: 101907
.. nonce: HgF1N2
.. section: C API

Removes use of non-standard C++ extension in public header files.

..

.. date: 2023-02-09-10-38-20
.. gh-issue: 99293
.. nonce: mFqfpp
.. section: C API

Document that the Py_TPFLAGS_VALID_VERSION_TAG is an internal feature,
should not be used, and will be removed.

..

.. date: 2023-02-06-16-14-30
.. gh-issue: 101578
.. nonce: PW5fA9
.. section: C API

Add :c:func:`PyErr_GetRaisedException` and
:c:func:`PyErr_SetRaisedException` for saving and restoring the current
exception. These functions return and accept a single exception object,
rather than the triple arguments of the now-deprecated :c:func:`PyErr_Fetch`
and :c:func:`PyErr_Restore`. This is less error prone and a bit more
efficient.

Add :c:func:`PyException_GetArgs` and :c:func:`PyException_SetArgs` as
convenience functions for retrieving and modifying the
:attr:`~BaseException.args` passed to the exception's constructor.

..

.. date: 2022-04-21-17-25-22
.. gh-issue: 91744
.. nonce: FgvaMi
.. section: C API

Introduced the *Unstable C API tier*, marking APi that is allowed to change
in minor releases without a deprecation period. See :pep:`689` for details.


================================================
File: /Misc/NEWS.d/3.12.0a7.rst
================================================
.. date: 2023-03-31-12-22-25
.. gh-issue: 102192
.. nonce: gYxJP_
.. release date: 2023-04-04
.. section: Core and Builtins

Deprecated ``_PyErr_ChainExceptions`` in favour of
``_PyErr_ChainExceptions1``.

..

.. date: 2023-03-24-02-50-33
.. gh-issue: 89987
.. nonce: oraTzh
.. section: Core and Builtins

Reduce the number of inline :opcode:`CACHE` entries for
:opcode:`BINARY_SUBSCR`.

..

.. date: 2023-03-21-00-46-36
.. gh-issue: 102859
.. nonce: PRkGca
.. section: Core and Builtins

Removed :opcode:`!JUMP_IF_FALSE_OR_POP` and :opcode:`!JUMP_IF_TRUE_OR_POP`
instructions.

..

.. date: 2023-03-18-02-36-39
.. gh-issue: 101975
.. nonce: HwMR1d
.. section: Core and Builtins

Fixed ``stacktop`` value on tracing entries to avoid corruption on garbage
collection.

..

.. date: 2023-03-17-13-43-34
.. gh-issue: 102778
.. nonce: ANDv8I
.. section: Core and Builtins

Add :data:`sys.last_exc` and deprecate :data:`sys.last_type`,
:data:`sys.last_value` and :data:`sys.last_traceback`, which hold the same
information in its legacy form.

..

.. date: 2023-03-17-12-09-45
.. gh-issue: 100982
.. nonce: Pf_BI6
.. section: Core and Builtins

Replace all occurrences of ``COMPARE_AND_BRANCH`` with :opcode:`COMPARE_OP`.

..

.. date: 2023-03-16-17-24-44
.. gh-issue: 102701
.. nonce: iNGVaS
.. section: Core and Builtins

Fix overflow when creating very large dict.

..

.. date: 2023-03-16-14-44-29
.. gh-issue: 102755
.. nonce: j1GxlV
.. section: Core and Builtins

Add :c:func:`PyErr_DisplayException` which takes just an exception instance,
to replace the legacy :c:func:`PyErr_Display` which takes the ``(typ, exc,
tb)`` triplet.

..

.. date: 2023-03-14-00-11-46
.. gh-issue: 102594
.. nonce: BjU-m2
.. section: Core and Builtins

Add note to exception raised in ``PyErr_SetObject`` when normalization
fails.

..

.. date: 2023-03-09-13-57-35
.. gh-issue: 90997
.. nonce: J-Yhn2
.. section: Core and Builtins

Shrink the number of inline :opcode:`CACHE` entries used by
:opcode:`LOAD_GLOBAL`.

..

.. date: 2023-03-08-08-37-36
.. gh-issue: 102491
.. nonce: SFvvsC
.. section: Core and Builtins

Improve import time of ``platform`` by removing IronPython version parsing.
The IronPython version parsing was not functional (see
https://github.com/IronLanguages/ironpython3/issues/1667).

..

.. date: 2023-03-06-10-02-22
.. gh-issue: 101291
.. nonce: 0FT2QS
.. section: Core and Builtins

Rearrage bits in first field (after header) of PyLongObject. * Bits 0 and 1:
1 - sign. I.e. 0 for positive numbers, 1 for zero and 2 for negative
numbers. * Bit 2 reserved (probably for the immortal bit) * Bits 3+ the
unsigned size.

This makes a few operations slightly more efficient, and will enable a more
compact and faster 2s-complement representation of most ints in future.

..

.. date: 2023-03-04-06-48-34
.. gh-issue: 102397
.. nonce: ACJaOf
.. section: Core and Builtins

Fix segfault from race condition in signal handling during garbage
collection. Patch by Kumar Aditya.

..

.. date: 2023-03-03-23-21-16
.. gh-issue: 102406
.. nonce: XLqYO3
.. section: Core and Builtins

:mod:`codecs` encoding/decoding errors now get the context information
(which operation and which codecs) attached as :pep:`678` notes instead of
through chaining a new instance of the exception.

..

.. date: 2023-03-02-13-49-21
.. gh-issue: 102281
.. nonce: QCuu2N
.. section: Core and Builtins

Fix potential nullptr dereference and use of uninitialized memory in
fileutils. Patch by Max Bachmann.

..

.. date: 2023-02-27-15-48-31
.. gh-issue: 102300
.. nonce: 8o-_Mt
.. section: Core and Builtins

Reuse operands with refcount of 1 in float specializations of BINARY_OP.

..

.. date: 2023-02-26-13-12-55
.. gh-issue: 102213
.. nonce: fTH8X7
.. section: Core and Builtins

Fix performance loss when accessing an object's attributes with
``__getattr__``  defined.

..

.. date: 2023-02-26-11-43-56
.. gh-issue: 102255
.. nonce: cRnI5x
.. section: Core and Builtins

Improve build support for the Xbox. Patch by Max Bachmann.

..

.. date: 2023-02-21-23-42-39
.. gh-issue: 102027
.. nonce: fQARG0
.. section: Core and Builtins

Fix SSE2 and SSE3 detection in ``_blake2`` internal module. Patch by Max
Bachmann.

..

.. date: 2023-02-21-17-22-06
.. gh-issue: 101865
.. nonce: fwrTOA
.. section: Core and Builtins

Deprecate ``co_lnotab`` in code objects, schedule it for removal in Python
3.14

..

.. bpo: 1635741
.. date: 2020-07-04-09-04-41
.. nonce: ZsP31Y
.. section: Core and Builtins

Adapt :mod:`!_pickle` to :pep:`687`. Patch by Mohamed Koubaa and Erlend
Aasland.

..

.. date: 2023-03-28-15-12-53
.. gh-issue: 103085
.. nonce: DqNehf
.. section: Library

Pure python :func:`locale.getencoding` will not warn deprecation.

..

.. date: 2023-03-28-05-14-59
.. gh-issue: 103068
.. nonce: YQTmrA
.. section: Library

It's no longer possible to register conditional breakpoints in
:class:`~pdb.Pdb` that raise :exc:`SyntaxError`. Patch by Tian Gao.

..

.. date: 2023-03-27-19-21-51
.. gh-issue: 102549
.. nonce: NQ6Nlv
.. section: Library

Don't ignore exceptions in member type creation.

..

.. date: 2023-03-27-15-01-16
.. gh-issue: 103056
.. nonce: -Efh5Q
.. section: Library

Ensure final ``_generate_next_value_`` is a ``staticmethod``.

..

.. date: 2023-03-26-20-54-57
.. gh-issue: 103046
.. nonce: xBlA2l
.. section: Library

Display current line label correctly in :mod:`dis` when ``show_caches`` is
False and ``lasti`` points to a CACHE entry.

..

.. date: 2023-03-25-16-57-18
.. gh-issue: 102433
.. nonce: L-7x2Q
.. section: Library

:func:`isinstance` checks against :func:`runtime-checkable protocols
<typing.runtime_checkable>` now use :func:`inspect.getattr_static` rather
than :func:`hasattr` to lookup whether attributes exist. This means that
descriptors and :meth:`~object.__getattr__` methods are no longer
unexpectedly evaluated during ``isinstance()`` checks against
runtime-checkable protocols. However, it may also mean that some objects
which used to be considered instances of a runtime-checkable protocol may no
longer be considered instances of that protocol on Python 3.12+, and vice
versa. Most users are unlikely to be affected by this change. Patch by Alex
Waygood.

..

.. date: 2023-03-25-02-08-05
.. gh-issue: 103023
.. nonce: Qfn7Hl
.. section: Library

It's no longer possible to register expressions to display in
:class:`~pdb.Pdb` that raise :exc:`SyntaxError`. Patch by Tian Gao.

..

.. date: 2023-03-23-13-34-33
.. gh-issue: 102947
.. nonce: cTwcpU
.. section: Library

Improve traceback when :func:`dataclasses.fields` is called on a
non-dataclass. Patch by Alex Waygood

..

.. date: 2023-03-22-16-15-18
.. gh-issue: 102780
.. nonce: NEcljy
.. section: Library

The :class:`asyncio.Timeout` context manager now works reliably even when
performing cleanup due to task cancellation.  Previously it could raise a
:exc:`~asyncio.CancelledError` instead of an :exc:`~asyncio.TimeoutError` in
such cases.

..

.. date: 2023-03-21-15-17-07
.. gh-issue: 102871
.. nonce: U9mchn
.. section: Library

Remove support for obsolete browsers from :mod:`webbrowser`. Removed
browsers include Grail, Mosaic, Netscape, Galeon, Skipstone, Iceape,
Firebird, and Firefox versions 35 and below.

..

.. date: 2023-03-20-12-21-19
.. gh-issue: 102839
.. nonce: RjRi12
.. section: Library

Improve performance of :func:`math.log` arguments handling by removing the
argument clinic.

..

.. date: 2023-03-19-15-30-59
.. gh-issue: 102828
.. nonce: NKClXg
.. section: Library

Add the ``onexc`` arg to :func:`shutil.rmtree`, which is like ``onerror``
but expects an exception instance rather than an exc_info tuple. Deprecate
``onerror``.

..

.. date: 2023-03-18-14-59-21
.. gh-issue: 88965
.. nonce: kA70Km
.. section: Library

typing: Fix a bug relating to substitution in custom classes generic over a
:class:`~typing.ParamSpec`. Previously, if the ``ParamSpec`` was substituted
with a parameters list that itself contained a :class:`~typing.TypeVar`, the
``TypeVar`` in the parameters list could not be subsequently substituted.
This is now fixed.

Patch by Nikita Sobolev.

..

.. date: 2023-03-17-19-14-26
.. gh-issue: 76846
.. nonce: KEamjK
.. section: Library

Fix issue where ``__new__()`` and ``__init__()`` methods of
:class:`pathlib.PurePath` and :class:`~pathlib.Path` subclasses were not
called in some circumstances.

..

.. date: 2023-03-16-16-43-04
.. gh-issue: 78530
.. nonce: Lr8eq_
.. section: Library

:func:`asyncio.wait` now accepts generators yielding tasks. Patch by Kumar
Aditya.

..

.. date: 2023-03-16-08-17-29
.. gh-issue: 102748
.. nonce: WNACpI
.. section: Library

:func:`asyncio.iscoroutine` now returns ``False`` for generators as
:mod:`asyncio` does not support legacy generator-based coroutines. Patch by
Kumar Aditya.

..

.. date: 2023-03-13-18-27-00
.. gh-issue: 102670
.. nonce: GyoThv
.. section: Library

Optimized fmean(), correlation(), covariance(), and linear_regression()
using the new math.sumprod() function.

..

.. date: 2023-03-13-12-05-55
.. gh-issue: 102615
.. nonce: NcA_ZL
.. section: Library

Typing: Improve the ``repr`` of generic aliases for classes generic over a
:class:`~typing.ParamSpec`. (Use square brackets to represent a parameter
list.)

..

.. date: 2023-03-10-13-51-21
.. gh-issue: 100112
.. nonce: VHh4mw
.. section: Library

:meth:`asyncio.Task.get_coro` now always returns a coroutine when wrapping
an awaitable object. Patch by Kumar Aditya.

..

.. date: 2023-03-10-13-21-16
.. gh-issue: 102578
.. nonce: -gujoI
.. section: Library

Speed up setting or deleting mutable attributes on non-dataclass subclasses
of frozen dataclasses. Due to the implementation of ``__setattr__`` and
``__delattr__`` for frozen dataclasses, this previously had a time
complexity of *O*\ (*n*). It now has a time complexity of *O*\ (1).

..

.. date: 2023-03-08-23-08-38
.. gh-issue: 102519
.. nonce: wlcsFI
.. section: Library

Add :func:`os.listdrives`, :func:`os.listvolumes` and :func:`os.listmounts`
functions on Windows for enumerating drives, volumes and mount points

..

.. date: 2023-03-04-20-58-29
.. gh-issue: 74468
.. nonce: Ac5Ew_
.. section: Library

Attribute name of the extracted :mod:`tarfile` file object now holds
filename of itself rather than of the archive it is contained in. Patch by
Oleg Iarygin.

..

.. date: 2023-03-03-19-53-08
.. gh-issue: 102378
.. nonce: kRdOZc
.. section: Library

Private helper method ``inspect._signature_strip_non_python_syntax`` will no
longer strip ``/`` from the input string.

..

.. date: 2023-02-26-17-29-57
.. gh-issue: 79940
.. nonce: SAfmAy
.. section: Library

Add :func:`inspect.getasyncgenstate` and :func:`inspect.getasyncgenlocals`.
Patch by Thomas Krennwallner.

..

.. date: 2023-02-21-11-56-16
.. gh-issue: 102103
.. nonce: Dj0WEj
.. section: Library

Add ``module`` argument to :func:`dataclasses.make_dataclass` and make
classes produced by it pickleable.

..

.. date: 2023-02-20-16-47-56
.. gh-issue: 102069
.. nonce: FS7f1j
.. section: Library

Fix ``__weakref__`` descriptor generation for custom dataclasses.

..

.. date: 2023-02-19-01-49-46
.. gh-issue: 102038
.. nonce: n3if3D
.. section: Library

Skip a ``stat`` in :mod:`site` if we have already found a ``pyvenv.cfg``

..

.. date: 2023-02-18-23-03-50
.. gh-issue: 98886
.. nonce: LkKGWv
.. section: Library

Fix issues when defining dataclasses that have fields with specific
underscore names that aren't clearly reserved by :mod:`dataclasses`.

..

.. date: 2023-02-09-19-40-41
.. gh-issue: 101673
.. nonce: mX-Ppq
.. section: Library

Fix a :mod:`pdb` bug where ``ll`` clears the changes to local variables.

..

.. date: 2023-01-27-14-51-07
.. gh-issue: 101313
.. nonce: 10AEXh
.. section: Library

Added -h and --help arguments to the webbrowser CLI

..

.. date: 2022-12-20-10-55-14
.. gh-issue: 100372
.. nonce: utfP65
.. section: Library

:meth:`ssl.SSLContext.load_verify_locations` no longer incorrectly accepts
some cases of trailing data when parsing DER.

..

.. date: 2022-12-16-10-27-58
.. gh-issue: 89727
.. nonce: y64ZLM
.. section: Library

Fix pathlib.Path.walk RecursionError on deep directory trees by rewriting it
using iteration instead of recursion.

..

.. date: 2022-12-09-11-21-38
.. gh-issue: 100131
.. nonce: v863yR
.. section: Library

Added an optional ``delete`` keyword argument to
:class:`tempfile.TemporaryDirectory`.

..

.. date: 2022-11-24-13-23-07
.. gh-issue: 48330
.. nonce: 6uAX9F
.. section: Library

Added ``--durations`` command line option, showing the N slowest test cases.
:class:`unittest.TextTestRunner` and :class:`unittest.TextTestResult`
constructors accept a new *durations* keyword argument. Subclasses should
take this into account or accept ``**kwargs``. Added
:meth:`unittest.TestResult.addDuration` method and
:attr:`unittest.TestResult.collectedDurations` attribute.

(Contributed by Giampaolo Rodola)

..

.. date: 2022-10-10-19-14-51
.. gh-issue: 98169
.. nonce: DBWIxL
.. section: Library

Fix :func:`dataclasses.astuple` crash when :class:`collections.defaultdict`
is present in the attributes.

..

.. date: 2022-09-19-08-12-58
.. gh-issue: 96931
.. nonce: x0WQhh
.. section: Library

Fix incorrect results from :meth:`ssl.SSLSocket.shared_ciphers`

..

.. date: 2022-07-30-23-01-43
.. gh-issue: 95495
.. nonce: RA-q1d
.. section: Library

When built against OpenSSL 3.0, the :mod:`ssl` module had a bug where it
reported unauthenticated EOFs (i.e. without close_notify) as a clean
TLS-level EOF. It now raises :exc:`~ssl.SSLEOFError`, matching the behavior
in previous versions of OpenSSL. The :attr:`~ssl.SSLContext.options`
attribute on :class:`~ssl.SSLContext` also no longer includes
:const:`~ssl.OP_IGNORE_UNEXPECTED_EOF` by default. This option may be set to
specify the previous OpenSSL 3.0 behavior.

..

.. date: 2022-07-09-13-07-30
.. gh-issue: 94684
.. nonce: nV5yno
.. section: Library

Now :func:`uuid.uuid3` and :func:`uuid.uuid5` functions support
:class:`bytes` objects as their *name* argument.

..

.. date: 2022-06-30-21-28-41
.. gh-issue: 94440
.. nonce: LtgX0d
.. section: Library

Fix a :mod:`concurrent.futures.process` bug where ``ProcessPoolExecutor``
shutdown could hang after a future has been quickly submitted and canceled.

..

.. date: 2022-04-11-18-34-33
.. gh-issue: 72346
.. nonce: pC7gnM
.. section: Library

Added deprecation warning to *isdst* parameter of
:func:`email.utils.localtime`.

..

.. bpo: 36305
.. date: 2019-03-15-22-50-27
.. nonce: Pbkv6u
.. section: Library

Fix handling of Windows filenames that resemble drives, such as ``./a:b``,
in :mod:`pathlib`.

..

.. date: 2023-03-29-14-51-39
.. gh-issue: 103112
.. nonce: XgGSEO
.. section: Documentation

Add docstring to :meth:`http.client.HTTPResponse.read` to fix ``pydoc``
output.

..

.. date: 2023-03-23-23-25-18
.. gh-issue: 102980
.. nonce: Zps4QF
.. section: Tests

Improve test coverage on :mod:`pdb`.

..

.. date: 2023-03-08-13-54-20
.. gh-issue: 102537
.. nonce: Vfplpb
.. section: Tests

Adjust the error handling strategy in
``test_zoneinfo.TzPathTest.python_tzpath_context``. Patch by Paul Ganssle.

..

.. date: 2023-01-27-18-10-40
.. gh-issue: 101377
.. nonce: IJGpqh
.. section: Tests

Improved test_locale_calendar_formatweekday of calendar.

..

.. date: 2023-03-23-20-58-56
.. gh-issue: 102973
.. nonce: EaJUrw
.. section: Build

Add a dev container (along with accompanying Dockerfile) for development
purposes.

..

.. date: 2023-03-15-02-03-39
.. gh-issue: 102711
.. nonce: zTkjts
.. section: Build

Fix ``-Wstrict-prototypes`` compiler warnings.

..

.. date: 2023-03-14-10-52-43
.. gh-issue: 102690
.. nonce: sbXtqk
.. section: Windows

Update :mod:`webbrowser` to fall back to Microsoft Edge instead of Internet
Explorer.

..

.. date: 2023-02-22-17-26-10
.. gh-issue: 99726
.. nonce: 76t957
.. section: Windows

Improves correctness of stat results for Windows, and uses faster API when
available

..

.. date: 2023-03-21-01-27-07
.. gh-issue: 102809
.. nonce: 2F1Byz
.. section: Tools/Demos

``Misc/gdbinit`` was removed.

..

.. date: 2023-02-18-00-55-14
.. gh-issue: 102013
.. nonce: 83mrtI
.. section: C API

Add a new (unstable) C-API function for iterating over GC'able objects using
a callback: ``PyUnstable_VisitObjects``.


================================================
File: /Misc/NEWS.d/3.13.0a2.rst
================================================
.. date: 2023-11-20-14-13-02
.. gh-issue: 112243
.. nonce: FKdQnr
.. release date: 2023-11-22
.. section: Core and Builtins

Don't include comments in f-string debug expressions. Patch by Pablo Galindo

..

.. date: 2023-11-20-10-40-40
.. gh-issue: 112287
.. nonce: 15gWAK
.. section: Core and Builtins

Slightly optimize the Tier 2 (uop) interpreter by only loading ``oparg`` and
``operand`` when needed. Also double the trace size limit again, to 512 this
time.

..

.. date: 2023-11-19-15-57-23
.. gh-issue: 112266
.. nonce: BSJMbR
.. section: Core and Builtins

Change docstrings of :attr:`~object.__dict__` and
:attr:`~object.__weakref__`.

..

.. date: 2023-11-17-16-49-32
.. gh-issue: 111807
.. nonce: QvjP9_
.. section: Core and Builtins

Lower the max parser stack depth to 1000 under WASI debug builds.

..

.. date: 2023-11-15-20-20-51
.. gh-issue: 111798
.. nonce: cs-3t3
.. section: Core and Builtins

When Python is built in debug mode, set the C recursion limit to 500 instead
of 1500. A debug build is likely built with low optimization level which
implies higher stack memory usage than a release build. Patch by Victor
Stinner.

..

.. date: 2023-11-15-16-14-10
.. gh-issue: 106529
.. nonce: Y48ax9
.. section: Core and Builtins

Enable translating unspecialized ``FOR_ITER`` to Tier 2.

..

.. date: 2023-11-14-22-12-11
.. gh-issue: 111916
.. nonce: ZGCayL
.. section: Core and Builtins

Make hashlib related modules thread-safe without the GIL

..

.. date: 2023-11-07-12-59-02
.. gh-issue: 81137
.. nonce: qFpJCY
.. section: Core and Builtins

Deprecate assignment to a function's ``__code__`` field when the new code
object is of a mismatched type (e.g., from a generator to a plain function).

..

.. date: 2023-11-06-16-44-09
.. gh-issue: 79932
.. nonce: 2qv7uD
.. section: Core and Builtins

Raise exception if :meth:`frame.clear` is called on a suspended frame.

..

.. date: 2023-11-05-20-59-10
.. gh-issue: 81925
.. nonce: wKHLSS
.. section: Core and Builtins

Implement native thread ids for GNU KFreeBSD.

..

.. date: 2023-11-05-06-40-35
.. gh-issue: 111843
.. nonce: c045cB
.. section: Core and Builtins

Use exponential backoff to reduce the number of failed tier 2 optimization
attempts by over 99%.

..

.. date: 2023-11-04-13-36-51
.. gh-issue: 110829
.. nonce: Pa0CJI
.. section: Core and Builtins

Joining a thread now ensures the underlying OS thread has exited. This is
required for safer fork() in multi-threaded processes.

..

.. date: 2023-11-03-22-48-29
.. gh-issue: 109369
.. nonce: ELYaxJ
.. section: Core and Builtins

Make sure that tier 2 traces are de-optimized if the code is instrumented

..

.. date: 2023-11-03-19-25-38
.. gh-issue: 111772
.. nonce: aRQvOn
.. section: Core and Builtins

Specialize slot loads and stores for _Py_T_OBJECT as well as Py_T_OBJECT_EX

..

.. date: 2023-11-03-01-23-48
.. gh-issue: 111666
.. nonce: l8Q8G5
.. section: Core and Builtins

Speed up :meth:`BaseExceptionGroup.derive`,
:meth:`BaseExceptionGroup.subgroup`, and :meth:`BaseExceptionGroup.split` by
changing how they parse passed arguments.

..

.. date: 2023-11-03-01-04-55
.. gh-issue: 111654
.. nonce: scUhDO
.. section: Core and Builtins

Fix runtime crash when some error happens in opcode
``LOAD_FROM_DICT_OR_DEREF``.

..

.. date: 2023-11-02-15-00-57
.. gh-issue: 111623
.. nonce: BZxYc8
.. section: Core and Builtins

Add support for sharing tuples between interpreters using the
cross-interpreter API.  Patch by Anthony Shaw.

..

.. date: 2023-11-02-14-49-19
.. gh-issue: 111354
.. nonce: gIS3f-
.. section: Core and Builtins

The oparg of :opcode:`YIELD_VALUE` is now ``1`` if the instruction is part
of a yield-from or await, and ``0`` otherwise.

The SUSPENDED frame state is now split into ``SUSPENDED`` and
``SUSPENDED_YIELD_FROM``. This simplifies the code in ``_PyGen_yf``.

..

.. date: 2023-10-31-21-33-35
.. gh-issue: 111520
.. nonce: vw-rxJ
.. section: Core and Builtins

Merge the Tier 1 (bytecode) and Tier 2 (micro-ops) interpreters together,
moving the Tier 2 interpreter loop and switch into
``_PyEval_EvalFrameDefault()`` in ``Python/ceval.c``. The
``Python/executor.c`` file is gone. Also the ``TIER_ONE`` and ``TIER_TWO``
macros are now handled by the code generator.

**Beware!** This changes the environment variables to enable micro-ops and
their debugging to ``PYTHON_UOPS`` and ``PYTHON_LLTRACE``.

..

.. date: 2023-10-31-14-25-21
.. gh-issue: 109181
.. nonce: 11h6Mc
.. section: Core and Builtins

Speed up :class:`Traceback` object creation by lazily compute the line number.
Patch by Pablo Galindo

..

.. date: 2023-10-29-20-11-21
.. gh-issue: 111420
.. nonce: IUT-GK
.. section: Core and Builtins

Allow type comments in parenthesized ``with`` statements

..

.. date: 2023-10-29-12-33-33
.. gh-issue: 111438
.. nonce: bHTLLl
.. section: Core and Builtins

Add support for sharing floats between interpreters using the
cross-interpreter API.  Patch by Anthony Shaw.

..

.. date: 2023-10-29-11-35-21
.. gh-issue: 111435
.. nonce: ageUWQ
.. section: Core and Builtins

Add support for sharing of ``True`` and ``False`` between interpreters using the
cross-interpreter API.  Patch by Anthony Shaw.

..

.. date: 2023-10-27-19-38-33
.. gh-issue: 102388
.. nonce: vd5YUZ
.. section: Core and Builtins

Fix a bug where ``iso2022_jp_3`` and ``iso2022_jp_2004`` codecs read out of
bounds

..

.. date: 2023-10-27-12-17-49
.. gh-issue: 111366
.. nonce: _TSknV
.. section: Core and Builtins

Fix an issue in the :mod:`codeop` that was causing :exc:`SyntaxError`
exceptions raised in the presence of invalid syntax to not contain precise
error messages. Patch by Pablo Galindo

..

.. date: 2023-10-27-11-51-40
.. gh-issue: 111380
.. nonce: vgSbir
.. section: Core and Builtins

Fix a bug that was causing :exc:`SyntaxWarning` to appear twice when parsing
if invalid syntax is encountered later. Patch by Pablo galindo

..

.. date: 2023-10-27-11-22-09
.. gh-issue: 111374
.. nonce: e9lrPZ
.. section: Core and Builtins

Added a new environment variable :envvar:`PYTHON_FROZEN_MODULES`. It
determines whether or not frozen modules are ignored by the import
machinery, equivalent of the :option:`-X frozen_modules <-X>` command-line
option.

..

.. date: 2023-10-26-18-45-20
.. gh-issue: 111354
.. nonce: GrT-Wf
.. section: Core and Builtins

Remove ``oparg`` from :opcode:`YIELD_VALUE`. Change ``oparg`` of
:opcode:`RESUME` to include information about the except-depth. These
changes make it possible to simplify the code in generator close.

..

.. date: 2023-10-23-22-11-09
.. gh-issue: 94438
.. nonce: y2pITu
.. section: Core and Builtins

Fix a regression that prevented jumping across ``is None`` and ``is not
None`` when debugging. Patch by Savannah Ostrowski.

..

.. date: 2023-10-23-15-44-47
.. gh-issue: 67224
.. nonce: S4D6CR
.. section: Core and Builtins

Show source lines in tracebacks when using the ``-c`` option when running
Python. Patch by Pablo Galindo

..

.. date: 2023-10-20-23-14-06
.. gh-issue: 111123
.. nonce: jjVc3M
.. section: Core and Builtins

Fix a bug where a :keyword:`global` declaration in an :keyword:`except`
block is rejected when the global is used in the :keyword:`else` block.

..

.. date: 2023-10-17-11-03-45
.. gh-issue: 110938
.. nonce: X3sbMb
.. section: Core and Builtins

Fix error messages for indented blocks with functions and classes with
generic type parameters. Patch by Pablo Galindo

..

.. date: 2023-10-16-15-51-37
.. gh-issue: 109214
.. nonce: -RGTFH
.. section: Core and Builtins

Remove unnecessary instruction pointer updates before returning from frames.

..

.. date: 2023-10-16-12-12-48
.. gh-issue: 110912
.. nonce: uEJGi_
.. section: Core and Builtins

Correctly display the traceback for :exc:`MemoryError` exceptions using the
:mod:`traceback` module. Patch by Pablo Galindo

..

.. date: 2023-10-15-22-18-45
.. gh-issue: 109894
.. nonce: UAmo06
.. section: Core and Builtins

Fixed crash due to improperly initialized static :exc:`MemoryError` in
subinterpreter.

..

.. date: 2023-10-15-20-45-35
.. gh-issue: 110892
.. nonce: oA6eVY
.. section: Core and Builtins

Return ``NULL`` for ``PyTrace_RETURN`` events caused by an exception

..

.. date: 2023-10-14-12-19-34
.. gh-issue: 110864
.. nonce: -baPDE
.. section: Core and Builtins

Fix argument parsing by ``_PyArg_UnpackKeywordsWithVararg`` for functions
defining pos-or-keyword, vararg, and kw-only parameters.

..

.. date: 2023-10-13-16-55-55
.. gh-issue: 109094
.. nonce: ziL4cJ
.. section: Core and Builtins

Replace ``prev_instr`` on the interpreter frame by ``instr_ptr`` which
points to the beginning of the instruction that is currently executing (or
will execute once the frame resumes).

..

.. date: 2023-10-13-09-21-29
.. gh-issue: 110805
.. nonce: vhU7A7
.. section: Core and Builtins

Allow the repl to show source code and complete tracebacks. Patch by Pablo
Galindo

..

.. date: 2023-10-12-17-15-23
.. gh-issue: 110722
.. nonce: sjMwQe
.. section: Core and Builtins

Add :envvar:`PYTHON_PRESITE=package.module` to import a module early in the
interpreter lifecycle before ``site.py`` is executed.  Python needs to be
:ref:`built in debug mode <debug-build>` for this option to exist.

..

.. date: 2023-10-12-12-09-01
.. gh-issue: 110481
.. nonce: 3Er3it
.. section: Core and Builtins

Implement biased reference counting in ``--disable-gil`` builds.

..

.. date: 2023-10-09-19-54-33
.. gh-issue: 110543
.. nonce: 1wrxO8
.. section: Core and Builtins

Fix regression in Python 3.12 where :meth:`types.CodeType.replace` would
produce a broken code object if called on a module or class code object that
contains a comprehension. Patch by Jelle Zijlstra.

..

.. date: 2023-09-30-17-30-11
.. gh-issue: 89519
.. nonce: hz2pZf
.. section: Core and Builtins

Removed chained :class:`classmethod` descriptors (introduced in
:issue:`19072`).  This can no longer be used to wrap other descriptors such
as :class:`property`.  The core design of this feature was flawed and caused
a number of downstream problems.  To "pass-through" a :class:`classmethod`,
consider using the :attr:`!__wrapped__` attribute that was added in Python
3.10.

..

.. date: 2023-09-15-23-39-43
.. gh-issue: 103615
.. nonce: WZavly
.. section: Core and Builtins

Use local events for opcode tracing

..

.. bpo: 46657
.. date: 2023-09-06-12-36-11
.. nonce: xea1T_
.. section: Core and Builtins

Add mimalloc memory allocator support.

..

.. date: 2023-08-31-11-42-16
.. gh-issue: 106718
.. nonce: _-57DA
.. section: Core and Builtins

When PyConfig.stdlib_dir is explicitly set, it's now respected and won't be
overridden by PyConfig.home.

..

.. date: 2023-07-20-11-41-16
.. gh-issue: 106905
.. nonce: AyZpuB
.. section: Core and Builtins

Fix incorrect SystemError about AST constructor recursion depth mismatch.

..

.. date: 2022-12-27-02-51-45
.. gh-issue: 100445
.. nonce: C8f6ph
.. section: Core and Builtins

Improve error message for unterminated strings with escapes.

..

.. bpo: 45759
.. date: 2021-11-10-10-40-05
.. nonce: WJoB3D
.. section: Core and Builtins

Improved error messages for ``elif``/``else`` statements not matching any
valid statements. Patch by Jeremiah Vivian.

..

.. date: 2023-11-14-18-43-55
.. gh-issue: 111942
.. nonce: x1pnrj
.. section: Library

Fix SystemError in the TextIOWrapper constructor with non-encodable "errors"
argument in non-debug mode.

..

.. date: 2023-11-14-16-31-59
.. gh-issue: 111995
.. nonce: OoX8JJ
.. section: Library

Added the ``NI_IDN`` constant to the :mod:`socket` module when present in C
at build time for use with :func:`socket.getnameinfo`.

..

.. date: 2023-11-11-16-42-48
.. gh-issue: 109538
.. nonce: cMG5ux
.. section: Library

Issue warning message instead of having :class:`RuntimeError` be displayed
when event loop has already been closed at :meth:`StreamWriter.__del__`.

..

.. date: 2023-11-10-22-08-28
.. gh-issue: 111942
.. nonce: MDFm6v
.. section: Library

Fix crashes in :meth:`io.TextIOWrapper.reconfigure` when pass invalid
arguments, e.g. non-string encoding.

..

.. date: 2023-11-09-12-57-43
.. gh-issue: 111460
.. nonce: TQaz9I
.. section: Library

:mod:`curses`: restore wide character support (including
:func:`curses.unget_wch` and :meth:`~curses.window.get_wch`) on macOS, which
was unavailable due to a regression in Python 3.12.

..

.. date: 2023-11-09-10-45-56
.. gh-issue: 103791
.. nonce: sdfkja
.. section: Library

:class:`contextlib.suppress` now supports suppressing exceptions raised as
part of a :exc:`BaseExceptionGroup`, in addition to the recent support for
:exc:`ExceptionGroup`.

..

.. date: 2023-11-08-23-32-03
.. gh-issue: 111835
.. nonce: ufFiuW
.. section: Library

The :class:`mmap.mmap` class now has an :meth:`~mmap.mmap.seekable` method
that can be used when a seekable file-like object is required.
The :meth:`~mmap.mmap.seek` method now returns the new absolute position.
Patch by Donghee Na.

..

.. date: 2023-11-08-15-58-57
.. gh-issue: 111804
.. nonce: uAXTOL
.. section: Library

Remove posix.fallocate() under WASI as the underlying posix_fallocate() is
not available in WASI preview2.

..

.. date: 2023-11-08-11-50-49
.. gh-issue: 111841
.. nonce: iSqdQf
.. section: Library

Fix truncating arguments on an embedded null character in :meth:`os.putenv`
and :meth:`os.unsetenv` on Windows.

..

.. date: 2023-11-08-07-42-53
.. gh-issue: 111768
.. nonce: g-WpnV
.. section: Library

:func:`wsgiref.util.is_hop_by_hop` is now exposed correctly in ``__all__``.

..

.. date: 2023-11-04-21-12-27
.. gh-issue: 80731
.. nonce: Wq51xg
.. section: Library

Avoid executing the default function in :class:`cmd.Cmd` in an except block

..

.. date: 2023-11-04-10-24-25
.. gh-issue: 111541
.. nonce: x0RBI1
.. section: Library

Fix :mod:`doctest` for :exc:`SyntaxError` not-builtin subclasses.

..

.. date: 2023-11-04-01-20-23
.. gh-issue: 111719
.. nonce: fUiKBD
.. section: Library

Add extra argument validation for ``alias`` command in :mod:`pdb`

..

.. date: 2023-11-02-12-15-46
.. gh-issue: 111482
.. nonce: FWqZIU
.. section: Library

:mod:`time`: Make :func:`time.clock_gettime` and
:func:`time.clock_gettime_ns` functions up to 2x faster by faster calling
convention. Patch by Victor Stinner.

..

.. date: 2023-11-01-14-03-24
.. gh-issue: 110894
.. nonce: 7-wZxC
.. section: Library

Call loop exception handler for exceptions in ``client_connected_cb`` of
:func:`asyncio.start_server` so that applications can handle it. Patch by
Kumar Aditya.

..

.. date: 2023-10-31-07-46-56
.. gh-issue: 111531
.. nonce: 6zUV_G
.. section: Library

Fix reference leaks in ``bind_class()`` and ``bind_all()`` methods of
:mod:`tkinter` widgets.

..

.. date: 2023-10-30-14-47-23
.. gh-issue: 111246
.. nonce: QJ_ehs
.. section: Library

:meth:`asyncio.loop.create_unix_server` will now automatically remove the
Unix socket when the server is closed.

..

.. date: 2023-10-30-08-50-46
.. gh-issue: 111356
.. nonce: Bc8LvA
.. section: Library

Added :func:`io.text_encoding`, :data:`io.DEFAULT_BUFFER_SIZE`, and
:class:`io.IncrementalNewlineDecoder` to ``io.__all__``.

..

.. date: 2023-10-29-03-46-27
.. gh-issue: 66425
.. nonce: FWTdDo
.. section: Library

Remove the code to set the REMOTE_HOST header from wsgiref module, as it is
unreachable. This header is used for performance reasons, which is not
necessary in the wsgiref module.

..

.. date: 2023-10-28-22-11-11
.. gh-issue: 111429
.. nonce: mJGxuQ
.. section: Library

Speed up :meth:`pathlib.PurePath.relative_to` and
:meth:`~pathlib.PurePath.is_relative_to`.

..

.. date: 2023-10-28-04-21-17
.. gh-issue: 111342
.. nonce: m8Ln1k
.. section: Library

Fixed typo in :func:`math.sumprod`.

..

.. date: 2023-10-27-12-46-56
.. gh-issue: 68166
.. nonce: 0EbWW4
.. section: Library

Remove mention of not supported "vsapi" element type in
:meth:`tkinter.ttk.Style.element_create`. Add tests for ``element_create()``
and other ``ttk.Style`` methods. Add examples for ``element_create()`` in
the documentation.

..

.. date: 2023-10-27-09-56-20
.. gh-issue: 111388
.. nonce: SlmDbC
.. section: Library

Add ``show_group`` parameter to :func:`traceback.format_exception_only`,
which allows to format :exc:`ExceptionGroup` instances.

..

.. date: 2023-10-25-11-54-00
.. gh-issue: 79033
.. nonce: 5ePgFl
.. section: Library

Another attempt at fixing :func:`asyncio.Server.wait_closed`. It now
blocks until both conditions are true: the server is closed, *and* there are
no more active connections. (This means that in some cases where in 3.12.0
this function would *incorrectly* have returned immediately, it will now
block; in particular, when there are no active connections but the server
hasn't been closed yet.)

..

.. date: 2023-10-25-11-13-35
.. gh-issue: 111259
.. nonce: z7ndeA
.. section: Library

Optimize recursive wildcards in :mod:`pathlib`.

..

.. date: 2023-10-25-08-42-05
.. gh-issue: 111295
.. nonce: H2K4lf
.. section: Library

Fix :mod:`time` not checking for errors when initializing.

..

.. date: 2023-10-24-12-20-46
.. gh-issue: 111253
.. nonce: HFywSK
.. section: Library

Add error checking during :mod:`!_socket` module init.

..

.. date: 2023-10-24-12-09-46
.. gh-issue: 111251
.. nonce: urFYtn
.. section: Library

Fix :mod:`!_blake2` not checking for errors when initializing.

..

.. date: 2023-10-23-23-14-54
.. gh-issue: 111233
.. nonce: sCdCC0
.. section: Library

Fix :mod:`select` not checking for errors when initializing.

..

.. date: 2023-10-23-22-40-47
.. gh-issue: 111230
.. nonce: k3Jm84
.. section: Library

Fix :mod:`ssl` not checking for errors when initializing.

..

.. date: 2023-10-23-13-53-58
.. gh-issue: 111174
.. nonce: Oohmzd
.. section: Library

Fix crash in :meth:`io.BytesIO.getbuffer` called repeatedly for empty
BytesIO.

..

.. date: 2023-10-22-21-28-05
.. gh-issue: 111187
.. nonce: _W11Ab
.. section: Library

Postpone removal version for locale.getdefaultlocale() to Python 3.15.

..

.. date: 2023-10-21-13-57-06
.. gh-issue: 111159
.. nonce: GoHp7s
.. section: Library

Fix :mod:`doctest` output comparison for exceptions with notes.

..

.. date: 2023-10-20-15-29-10
.. gh-issue: 110910
.. nonce: u2oPwX
.. section: Library

Fix invalid state handling in :class:`asyncio.TaskGroup` and
:class:`asyncio.Timeout`. They now raise proper RuntimeError if they are
improperly used and are left in consistent state after this.

..

.. date: 2023-10-19-22-46-34
.. gh-issue: 111092
.. nonce: hgut12
.. section: Library

Make turtledemo run without default root enabled.

..

.. date: 2023-10-16-18-41-51
.. gh-issue: 110944
.. nonce: CmUKXo
.. section: Library

Support alias and convenience vars for :mod:`pdb` completion

..

.. date: 2023-10-15-08-08-26
.. gh-issue: 110745
.. nonce: mxEkh0
.. section: Library

Added *newline* parameter to :meth:`pathlib.Path.read_text`. Patch by Junya
Okabe.

..

.. date: 2023-10-14-21-33-57
.. gh-issue: 84583
.. nonce: -Cmn4_
.. section: Library

Make :mod:`pdb` enter post-mortem mode even for :exc:`SyntaxError`

..

.. date: 2023-10-14-20-15-53
.. gh-issue: 80675
.. nonce: _M-cQC
.. section: Library

Set ``f_trace_lines = True`` on all frames upon :func:`pdb.set_trace`

..

.. date: 2023-10-13-06-47-20
.. gh-issue: 110771
.. nonce: opwdlc
.. section: Library

Expose the setup and cleanup portions of ``asyncio.run_forever()`` as the
standalone methods ``asyncio.run_forever_setup()`` and
``asyncio.run_forever_cleanup()``. This allows for tighter integration with
GUI event loops.

..

.. date: 2023-10-12-15-16-44
.. gh-issue: 110774
.. nonce: AdCb5A
.. section: Library

Support setting the :class:`asyncio.Runner` loop_factory kwarg in
:class:`unittest.IsolatedAsyncioTestCase`

..

.. date: 2023-10-10-17-56-41
.. gh-issue: 110392
.. nonce: 6g6CnP
.. section: Library

Fix :func:`tty.setraw` and :func:`tty.setcbreak`: previously they returned
partially modified list of the original tty attributes.
:func:`tty.cfmakeraw` and :func:`tty.cfmakecbreak` now make a copy of the
list of special characters before modifying it.

..

.. date: 2023-10-09-23-59-04
.. gh-issue: 59013
.. nonce: qPbS-G
.. section: Library

Make line number of function breakpoint more precise in :mod:`pdb`

..

.. date: 2023-10-08-18-38-09
.. gh-issue: 88434
.. nonce: 2Q_IkG
.. section: Library

Emit deprecation warning for non-integer numbers in :mod:`gettext` functions
and methods that consider plural forms even if the translation was not
found.

..

.. date: 2023-10-08-14-17-06
.. gh-issue: 110395
.. nonce: _tdCsV
.. section: Library

Ensure that :func:`select.kqueue` objects correctly appear as closed in
forked children, to prevent operations on an invalid file descriptor.

..

.. date: 2023-10-02-05-23-27
.. gh-issue: 110196
.. nonce: djwt0z
.. section: Library

Add ``__reduce__`` method to :class:`IPv6Address` in order to keep
``scope_id``

..

.. date: 2023-09-25-20-05-41
.. gh-issue: 109747
.. nonce: _cRJH8
.. section: Library

Improve errors for unsupported look-behind patterns. Now re.error is raised
instead of OverflowError or RuntimeError for too large width of look-behind
pattern.

..

.. date: 2023-09-15-12-30-21
.. gh-issue: 109466
.. nonce: 6ah-aw
.. section: Library

Add the :attr:`ipaddress.IPv4Address.ipv6_mapped` property, which returns the
IPv4-mapped IPv6 address.

..

.. date: 2023-09-08-12-10-10
.. gh-issue: 85098
.. nonce: DfQbeJ
.. section: Library

Implement the CLI of the :mod:`symtable` module and improve the repr of
:class:`~symtable.Symbol`.

..

.. date: 2023-09-02-16-07-23
.. gh-issue: 108791
.. nonce: fBcAqh
.. section: Library

Improved error handling in :mod:`pdb` command line interface, making it
produce more concise error messages.

..

.. date: 2023-08-30-19-10-35
.. gh-issue: 105931
.. nonce: Lpwve8
.. section: Library

Change :mod:`compileall` to only strip the stripdir prefix from the full
path recorded in the compiled ``.pyc`` file, when the prefix matches the
start of the full path in its entirety. When the prefix does not match, no
stripping is performed and a warning to this effect is displayed.

Previously all path components of the stripdir prefix that matched the full
path were removed, while those that did not match were left alone (including
ones interspersed between matching components).

..

.. date: 2023-07-29-19-00-39
.. gh-issue: 107431
.. nonce: 1GzJ2p
.. section: Library

Make the ``DictProxy`` and ``ListProxy`` types in
:mod:`multiprocessing.managers` :ref:`Generic Alias
Types<types-genericalias>` for ``[]`` use in typing contexts.

..

.. date: 2023-07-13-00-24-52
.. gh-issue: 72904
.. nonce: Yn5-j0
.. section: Library

Add :func:`glob.translate`. This function converts a pathname with
shell-style wildcards to a regular expression.

..

.. date: 2023-05-30-02-01-14
.. gh-issue: 90026
.. nonce: FyCXw8
.. section: Library

Define ``USE_XATTRS`` on Cygwin so that XATTR-related functions in the
:mod:`os` module become available.

..

.. date: 2023-04-26-16-37-00
.. gh-issue: 90890
.. nonce: fIag4w
.. section: Library

New methods :meth:`mailbox.Maildir.get_info`,
:meth:`mailbox.Maildir.set_info`, :meth:`mailbox.Maildir.get_flags`,
:meth:`mailbox.Maildir.set_flags`, :meth:`mailbox.Maildir.add_flag`,
:meth:`mailbox.Maildir.remove_flag`. These methods speed up accessing a
message's info and/or flags and are useful when it is not necessary to
access the message's contents, as when iterating over a Maildir to find
messages with specific flags.

..

.. date: 2023-04-15-14-45-21
.. gh-issue: 102956
.. nonce: Z6qeUy
.. section: Library

Fix returning of empty byte strings after seek in zipfile module

..

.. date: 2023-03-22-02-01-30
.. gh-issue: 102895
.. nonce: HiEqaZ
.. section: Library

Added a parameter ``local_exit`` for :func:`code.interact` to prevent
``exit()`` and ``quit`` from closing ``sys.stdin`` and raise ``SystemExit``.

..

.. date: 2022-10-14-21-11-10
.. gh-issue: 97928
.. nonce: Pdxh1G
.. section: Library

Change the behavior of :meth:`tkinter.Text.count`. It now always returns an
integer if one or less counting options are specified. Previously it could
return a single count as a 1-tuple, an integer (only if option ``"update"``
was specified) or ``None`` if no items found. The result is now the same if
``wantobjects`` is set to ``0``.

..

.. date: 2022-10-05-15-01-36
.. gh-issue: 96954
.. nonce: ezwkrU
.. section: Library

Switch the storage of the unicode codepoint names to use a different
data-structure, a `directed acyclic word graph
<https://en.wikipedia.org/wiki/Deterministic_acyclic_finite_state_automaton>`_.
This makes the unicodedata shared library about 440 KiB smaller. Contributed
by Carl Friedrich Bolz-Tereick using code from the PyPy project.

..

.. date: 2022-05-28-20-55-07
.. gh-issue: 73561
.. nonce: YRmAvy
.. section: Library

Omit the interface scope from an IPv6 address when used as Host header by
:mod:`http.client`.

..

.. date: 2022-05-06-15-49-57
.. gh-issue: 86826
.. nonce: rf006W
.. section: Library

:mod:`zipinfo` now supports the full range of values in the TZ string
determined by RFC 8536 and detects all invalid formats. Both Python and C
implementations now raise exceptions of the same type on invalid data.

..

.. date: 2023-11-17-15-20-41
.. gh-issue: 111808
.. nonce: jtIayt
.. section: Tests

Make the default value of ``test.support.infinite_recursion()`` to be
conditional based on whether optimizations were used when compiling the
interpreter. This helps with platforms like WASI whose stack size is greatly
restricted in debug builds.

..

.. date: 2023-11-03-18-59-13
.. gh-issue: 110722
.. nonce: jvT1pb
.. section: Tests

Gathering line coverage of standard libraries within the regression test
suite is now precise, as well as much faster. Patch by Łukasz Langa.

..

.. date: 2023-10-31-22-09-25
.. gh-issue: 110367
.. nonce: UhQi44
.. section: Tests

Make regrtest ``--verbose3`` option compatible with ``--huntrleaks -jN``
options. The ``./python -m test -j1 -R 3:3 --verbose3`` command now works as
expected. Patch by Victor Stinner.

..

.. date: 2023-10-21-19-27-36
.. gh-issue: 111165
.. nonce: FU6mUk
.. section: Tests

Remove no longer used functions ``run_unittest()`` and ``run_doctest()``
from the :mod:`test.support` module.

..

.. date: 2023-10-21-00-10-36
.. gh-issue: 110932
.. nonce: jktjJU
.. section: Tests

Fix regrtest if the ``SOURCE_DATE_EPOCH`` environment variable is defined:
use the variable value as the random seed. Patch by Victor Stinner.

..

.. date: 2023-10-17-17-54-36
.. gh-issue: 110995
.. nonce: Fx8KRD
.. section: Tests

test_gdb: Fix detection of gdb built without Python scripting support. Patch
by Victor Stinner.

..

.. date: 2023-10-16-13-47-24
.. gh-issue: 110918
.. nonce: aFgZK3
.. section: Tests

Test case matching patterns specified by options ``--match``, ``--ignore``,
``--matchfile`` and ``--ignorefile`` are now tested in the order of
specification, and the last match determines whether the test case be run or
ignored.

..

.. date: 2023-09-15-15-00-14
.. gh-issue: 108747
.. nonce: ql0owS
.. section: Tests

Add unit test for ``usercustomize`` and ``sitecustomize`` hooks from
:class:`site`.

..

.. date: 2023-11-15-16-56-20
.. gh-issue: 96954
.. nonce: 6FYvKn
.. section: Build

Make ``make regen-unicodedata`` work for out-of-tree builds of CPython.

..

.. date: 2023-11-15-13-40-29
.. gh-issue: 112088
.. nonce: UJQxxh
.. section: Build

Add ``Tools/build/regen-configure.sh`` script to regenerate the
``configure`` with an Ubuntu container image. The
``quay.io/tiran/cpython_autoconf:271`` container image
(`tiran/cpython_autoconf <https://github.com/tiran/cpython_autoconf>`_) is
no longer used. Patch by Victor Stinner.

..

.. date: 2023-10-20-15-29-31
.. gh-issue: 111046
.. nonce: 2DxQl8
.. section: Build

For wasi-threads, memory is now exported to fix compatibility issues with
some wasm runtimes.

..

.. date: 2023-10-17-03-10-40
.. gh-issue: 110828
.. nonce: 31vQ9B
.. section: Build

AIX 32bit needs ``-latomic`` to build the :mod:`!_testcapi` extension
module.

..

.. date: 2023-10-17-01-56-11
.. gh-issue: 85283
.. nonce: V156T2
.. section: Build

The ``errno``, ``md5``, ``resource``, ``winsound``, ``_ctypes_test``,
``_multiprocessing.posixshmem``, ``_scproxy``, ``_stat``,
``_testimportmultiple`` and ``_uuid`` C extensions are now built with the
:ref:`limited C API <limited-c-api>`. Patch by Victor Stinner.

..

.. date: 2023-11-13-22-35-27
.. gh-issue: 111856
.. nonce: vEtA5z
.. section: Windows

Fixes :func:`~os.fstat` on file systems that do not support file ID
requests. This includes FAT32 and exFAT.

..

.. date: 2023-10-25-05-01-28
.. gh-issue: 111293
.. nonce: FSsLT6
.. section: Windows

Fix :data:`os.DirEntry.inode` dropping higher 64 bits of a file id on some
filesystems on Windows.

..

.. date: 2023-10-19-21-46-18
.. gh-issue: 110913
.. nonce: CWlPfg
.. section: Windows

WindowsConsoleIO now correctly chunks large buffers without splitting up
UTF-8 sequences.

..

.. date: 2023-10-31-22-13-05
.. gh-issue: 59703
.. nonce: SML6Ag
.. section: macOS

For macOS framework builds, in ``getpath.c`` use the system ``dladdr``
function to find the path to the shared library rather than depending on
deprecated macOS APIs.

..

.. date: 2023-10-18-17-26-36
.. gh-issue: 110950
.. nonce: sonoma
.. section: macOS

Update macOS installer to include an upstream Tcl/Tk fix for the ``Secure
coding is not enabled for restorable state!`` warning encountered in Tkinter
on macOS 14 Sonoma.

..

.. date: 2023-10-18-01-40-36
.. gh-issue: 111015
.. nonce: NaLI2L
.. section: macOS

Ensure that IDLE.app and Python Launcher.app are installed with appropriate
permissions on macOS builds.

..

.. date: 2023-09-02-08-49-57
.. gh-issue: 71383
.. nonce: Ttkchg
.. section: macOS

Update macOS installer to include an upstream Tcl/Tk fix for the
``ttk::ThemeChanged`` error encountered in Tkinter.

..

.. date: 2023-08-30-16-33-57
.. gh-issue: 92603
.. nonce: ATkKVO
.. section: macOS

Update macOS installer to include a fix accepted by upstream Tcl/Tk for a
crash encountered after the first :meth:`tkinter.Tk` instance is destroyed.

..

.. bpo: 35668
.. date: 2019-01-07-06-18-25
.. nonce: JimxP5
.. section: IDLE

Add docstrings to the IDLE debugger module. Fix two bugs: initialize
``Idb.botframe`` (should be in Bdb); in ``Idb.in_rpc_code``, check whether
``prev_frame`` is ``None`` before trying to use it. Greatly expand test_debugger.

..

.. date: 2023-11-09-13-04-29
.. gh-issue: 111903
.. nonce: 7Prryr
.. section: Tools/Demos

Argument Clinic now supports the ``@critical_section`` directive that
instructs Argument Clinic to generate a critical section around the function
call, which locks the ``self`` object in ``--disable-gil`` builds. Patch by
Sam Gross.

..

.. date: 2023-11-15-18-36-21
.. gh-issue: 112026
.. nonce: _Yybr5
.. section: C API

Add again the private ``_PyThreadState_UncheckedGet()`` function as an alias
to the new public :c:func:`PyThreadState_GetUnchecked` function. Patch by
Victor Stinner.

..

.. date: 2023-11-15-17-10-09
.. gh-issue: 112026
.. nonce: ts9yyn
.. section: C API

Restore the removed ``_PyDict_GetItemStringWithError()`` function. It is
used by numpy. Patch by Victor Stinner.

..

.. date: 2023-11-15-16-07-57
.. gh-issue: 112026
.. nonce: bnr8dd
.. section: C API

Restore removed private C API functions, macros and structures which have no
simple replacement for now:

* _PyDict_GetItem_KnownHash()
* _PyDict_NewPresized()
* _PyHASH_BITS
* _PyHASH_IMAG
* _PyHASH_INF
* _PyHASH_MODULUS
* _PyHASH_MULTIPLIER
* _PyLong_Copy()
* _PyLong_FromDigits()
* _PyLong_New()
* _PyLong_Sign()
* _PyObject_CallMethodId()
* _PyObject_CallMethodNoArgs()
* _PyObject_CallMethodOneArg()
* _PyObject_CallOneArg()
* _PyObject_EXTRA_INIT
* _PyObject_FastCallDict()
* _PyObject_GetAttrId()
* _PyObject_Vectorcall()
* _PyObject_VectorcallMethod()
* _PyStack_AsDict()
* _PyThread_CurrentFrames()
* _PyUnicodeWriter structure
* _PyUnicodeWriter_Dealloc()
* _PyUnicodeWriter_Finish()
* _PyUnicodeWriter_Init()
* _PyUnicodeWriter_Prepare()
* _PyUnicodeWriter_PrepareKind()
* _PyUnicodeWriter_WriteASCIIString()
* _PyUnicodeWriter_WriteChar()
* _PyUnicodeWriter_WriteLatin1String()
* _PyUnicodeWriter_WriteStr()
* _PyUnicodeWriter_WriteSubstring()
* _PyUnicode_AsString()
* _PyUnicode_FromId()
* _PyVectorcall_Function()
* _Py_IDENTIFIER()
* _Py_c_abs()
* _Py_c_diff()
* _Py_c_neg()
* _Py_c_pow()
* _Py_c_prod()
* _Py_c_quot()
* _Py_c_sum()
* _Py_static_string()
* _Py_static_string_init()

Patch by Victor Stinner.

..

.. date: 2023-11-13-17-57-11
.. gh-issue: 112026
.. nonce: WJLJcI
.. section: C API

Add again ``<ctype.h>`` and ``<unistd.h>`` includes in ``Python.h``, but
don't include them in the limited C API version 3.13 and newer. Patch by
Victor Stinner.

..

.. date: 2023-11-10-10-24-28
.. gh-issue: 111956
.. nonce: ImE6Cx
.. section: C API

Add internal-only one-time initialization API: ``_PyOnceFlag`` and
``_PyOnceFlag_CallOnce``.

..

.. date: 2023-11-10-10-21-38
.. gh-issue: 111262
.. nonce: 2utB5m
.. section: C API

Add :c:func:`PyDict_Pop` and :c:func:`PyDict_PopString` functions: remove a
key from a dictionary and optionally return the removed value. This is
similar to :meth:`dict.pop`, but without the default value and not raising
:exc:`KeyError` if the key missing. Patch by Stefan Behnel and Victor
Stinner.

..

.. date: 2023-11-08-20-28-03
.. gh-issue: 111863
.. nonce: RPeFAX
.. section: C API

Rename ``Py_NOGIL`` to ``Py_GIL_DISABLED``. Patch by Hugo van Kemenade.

..

.. date: 2023-11-08-18-37-19
.. gh-issue: 111138
.. nonce: 3Ypq8h
.. section: C API

Add :c:func:`PyList_Extend` and :c:func:`PyList_Clear` functions: similar to
Python ``list.extend()`` and ``list.clear()`` methods. Patch by Victor
Stinner.

..

.. date: 2023-10-31-18-22-03
.. gh-issue: 108765
.. nonce: _beYv8
.. section: C API

On Windows, ``Python.h`` no longer includes the ``<stddef.h>`` standard
header file. If needed, it should now be included explicitly. Patch by
Victor Stinner.

..

.. date: 2023-10-31-14-58-17
.. gh-issue: 111569
.. nonce: _V8iu4
.. section: C API

Implement "Python Critical Sections" from :pep:`703`. These are macros to
help replace the GIL with per-object locks in the ``--disable-gil`` build of
CPython. The macros are no-ops in the default build.

..

.. date: 2023-10-30-18-13-01
.. gh-issue: 111506
.. nonce: EUdO22
.. section: C API

In the limited C API version 3.13, :c:func:`Py_SET_REFCNT` function is now
implemented as an opaque function call. Patch by Victor Stinner.

..

.. date: 2023-10-19-22-39-24
.. gh-issue: 108082
.. nonce: uJytvc
.. section: C API

Add :c:func:`PyErr_FormatUnraisable` function.

..

.. date: 2023-10-17-10-21-59
.. gh-issue: 110964
.. nonce: OxqEjd
.. section: C API

Move the undocumented private _PyArg functions and _PyArg_Parser structure
to internal C API (``pycore_modsupport.h``). Patch by Victor Stinner.

..

.. date: 2023-10-13-14-18-06
.. gh-issue: 110815
.. nonce: tEFLVl
.. section: C API

Support non-ASCII keyword names in :c:func:`PyArg_ParseTupleAndKeywords`.

..

.. date: 2023-10-02-23-08-53
.. gh-issue: 109587
.. nonce: UqqnDY
.. section: C API

Introduced :c:func:`PyUnstable_PerfTrampoline_CompileCode`,
:c:func:`PyUnstable_PerfTrampoline_SetPersistAfterFork` and
:c:func:`PyUnstable_CopyPerfMapFile`. These functions allow extension
modules to initialize trampolines eagerly, after the application is "warmed
up". This makes it possible to have perf-trampolines running in an
always-enabled fashion.

..

.. date: 2023-08-28-17-40-51
.. gh-issue: 85283
.. nonce: raFNiD
.. section: C API

Add the :c:func:`PySys_Audit` function to the limited C API. Patch by Victor
Stinner.

..

.. date: 2023-08-28-17-34-10
.. gh-issue: 85283
.. nonce: f1zXcc
.. section: C API

Add :c:func:`PyMem_RawMalloc`, :c:func:`PyMem_RawCalloc`,
:c:func:`PyMem_RawRealloc` and :c:func:`PyMem_RawFree` to the limited C API.
Patch by Victor Stinner.

..

.. date: 2023-07-12-12-14-52
.. gh-issue: 106672
.. nonce: fkRjmi
.. section: C API

Functions :c:func:`PyDict_GetItem`, :c:func:`PyDict_GetItemString`,
:c:func:`PyMapping_HasKey`, :c:func:`PyMapping_HasKeyString`,
:c:func:`PyObject_HasAttr`, :c:func:`PyObject_HasAttrString`, and
:c:func:`PySys_GetObject`, which clear all errors occurred during calling
the function, report now them using :func:`sys.unraisablehook`.

..

.. date: 2023-06-08-21-12-44
.. gh-issue: 67565
.. nonce: UkK3x-
.. section: C API

Remove redundant C-contiguity check in :file:`getargs.c`, :mod:`binascii`,
:mod:`ssl` and Argument Clinic. Patched by Stefan Krah and Furkan Onder


================================================
File: /Misc/NEWS.d/3.13.0a4.rst
================================================
.. date: 2024-02-13-15-14-39
.. gh-issue: 115399
.. nonce: xT-scP
.. release date: 2024-02-15
.. section: Security

Update bundled libexpat to 2.6.0

..

.. date: 2024-02-12-00-33-01
.. gh-issue: 115243
.. nonce: e1oGX8
.. section: Security

Fix possible crashes in :meth:`collections.deque.index` when the deque is
concurrently modified.

..

.. date: 2024-02-14-23-50-55
.. gh-issue: 112087
.. nonce: H_4W_v
.. section: Core and Builtins

For an empty reverse iterator for list will be reduced to :func:`reversed`.
Patch by Donghee Na

..

.. date: 2024-02-12-17-18-26
.. gh-issue: 114570
.. nonce: BzwMlJ
.. section: Core and Builtins

Add :exc:`PythonFinalizationError` exception. This exception derived from
:exc:`RuntimeError` is raised when an operation is blocked during the
:term:`Python finalization <interpreter shutdown>`. Patch by Victor Stinner.

..

.. date: 2024-02-07-18-04-36
.. gh-issue: 114695
.. nonce: o9wP5P
.. section: Core and Builtins

Add :func:`sys._clear_internal_caches`, which clears all internal
performance-related caches (and deprecate the less-general
:func:`sys._clear_type_cache` function).

..

.. date: 2024-02-07-07-50-12
.. gh-issue: 114828
.. nonce: nSXwMi
.. section: Core and Builtins

Fix compilation crashes in uncommon code examples using :func:`super` inside
a comprehension in a class body.

..

.. date: 2024-02-07-00-18-42
.. gh-issue: 112069
.. nonce: jRDRR5
.. section: Core and Builtins

Adapt :class:`set` and :class:`frozenset` methods to Argument Clinic.

..

.. date: 2024-02-05-12-40-26
.. gh-issue: 115011
.. nonce: L1AKF5
.. section: Core and Builtins

Setters for members with an unsigned integer type now support the same range
of valid values for objects that has a :meth:`~object.__index__` method as
for :class:`int`.

..

.. date: 2024-02-03-04-07-18
.. gh-issue: 114887
.. nonce: uLSFmN
.. section: Core and Builtins

Changed socket type validation in
:meth:`~asyncio.loop.create_datagram_endpoint` to accept all non-stream
sockets. This fixes a regression in compatibility with raw sockets.

..

.. date: 2024-02-03-01-48-38
.. gh-issue: 114944
.. nonce: 4J5ELD
.. section: Core and Builtins

Fixes a race between ``PyParkingLot_Park`` and ``_PyParkingLot_UnparkAll``.

..

.. date: 2024-02-02-05-27-48
.. gh-issue: 113462
.. nonce: VMml8q
.. section: Core and Builtins

Limit the number of versions that a single class can use. Prevents a few
wayward classes using up all the version numbers.

..

.. date: 2024-02-01-23-43-49
.. gh-issue: 76763
.. nonce: o_2J6i
.. section: Core and Builtins

The :func:`chr` builtin function now always raises :exc:`ValueError` for
values outside the valid range. Previously it raised :exc:`OverflowError`
for very large or small values.

..

.. date: 2024-02-01-18-16-52
.. gh-issue: 114806
.. nonce: wrH2J6
.. section: Core and Builtins

No longer specialize calls to classes, if those classes have metaclasses.
Fixes bug where the ``__call__`` method of the metaclass was not being
called.

..

.. date: 2024-01-31-09-10-10
.. gh-issue: 107944
.. nonce: XWm1B-
.. section: Core and Builtins

Improve error message for function calls with bad keyword arguments via
getargs

..

.. date: 2024-01-25-18-50-49
.. gh-issue: 112529
.. nonce: IbbApA
.. section: Core and Builtins

The free-threaded build no longer allocates space for the ``PyGC_Head``
structure in objects that support cyclic garbage collection.  A number of
other fields and data structures are used as replacements, including
``ob_gc_bits``, ``ob_tid``, and mimalloc internal data structures.

..

.. date: 2024-01-22-15-10-01
.. gh-issue: 114456
.. nonce: fBFEJF
.. section: Core and Builtins

Lower the recursion limit under a debug build of WASI.

..

.. date: 2024-01-22-09-49-02
.. gh-issue: 114083
.. nonce: hf1-ku
.. section: Core and Builtins

Compiler applies folding of LOAD_CONST with following instruction in a
separate pass before other optimisations. This enables jump threading in
certain circumstances.

..

.. date: 2024-01-21-17-29-32
.. gh-issue: 114388
.. nonce: UVGO4K
.. section: Core and Builtins

Fix a :exc:`RuntimeWarning` emitted when assign an integer-like value that
is not an instance of :class:`int` to an attribute that corresponds to a C
struct member of :ref:`type <PyMemberDef-types>` T_UINT and T_ULONG. Fix a
double :exc:`RuntimeWarning` emitted when assign a negative integer value to
an attribute that corresponds to a C struct member of type T_UINT.

..

.. date: 2024-01-19-13-18-13
.. gh-issue: 114265
.. nonce: 7HAi--
.. section: Core and Builtins

Compiler propagates line numbers before optimization, leading to more
optimization opportunities and removing the need for the
``guarantee_lineno_for_exits`` hack.

..

.. date: 2024-01-18-20-20-37
.. gh-issue: 112529
.. nonce: oVNvDG
.. section: Core and Builtins

The free-threaded build now has its own thread-safe GC implementation that
uses mimalloc to find GC tracked objects. It is non-generational, unlike the
existing GC implementation.

..

.. date: 2024-01-17-23-39-20
.. gh-issue: 114050
.. nonce: Lnv1oq
.. section: Core and Builtins

Fix segmentation fault caused by an incorrect format string in ``TypeError``
exception when more than two arguments are passed to ``int``.

..

.. date: 2024-01-17-05-09-32
.. gh-issue: 112354
.. nonce: Run9ko
.. section: Core and Builtins

The ``END_FOR`` instruction now pops only one value. This is to better
support side exits in loops.

..

.. date: 2024-01-17-00-52-57
.. gh-issue: 113884
.. nonce: CvEjUE
.. section: Core and Builtins

Make :class:`queue.SimpleQueue` thread safe when the GIL is disabled.

..

.. date: 2024-01-16-14-41-54
.. gh-issue: 114058
.. nonce: Cb2b8h
.. section: Core and Builtins

Implement the foundations of the Tier 2 redundancy eliminator.

..

.. date: 2024-01-12-16-40-07
.. gh-issue: 113939
.. nonce: Yi3L-e
.. section: Core and Builtins

frame.clear(): Clear frame.f_locals as well, and not only the fast locals.
This is relevant once frame.f_locals was accessed, which would contain also
references to all the locals.

..

.. date: 2024-01-11-22-58-45
.. gh-issue: 112050
.. nonce: hDuvDW
.. section: Core and Builtins

Convert :class:`collections.deque` to use Argument Clinic.

..

.. date: 2024-01-08-21-57-41
.. gh-issue: 112050
.. nonce: qwgjx1
.. section: Core and Builtins

Make methods on :class:`collections.deque` thread-safe when the GIL is
disabled.

..

.. date: 2023-12-24-03-25-28
.. gh-issue: 113464
.. nonce: dvjQmA
.. section: Core and Builtins

Add an option (``--enable-experimental-jit`` for ``configure``-based builds
or ``--experimental-jit`` for ``PCbuild``-based ones) to build an
*experimental* just-in-time compiler, based on `copy-and-patch
<https://fredrikbk.com/publications/copy-and-patch.pdf>`_

..

.. date: 2023-12-22-13-21-39
.. gh-issue: 113055
.. nonce: 47xBMF
.. section: Core and Builtins

Make interp->obmalloc a pointer. For interpreters that share state with the
main interpreter, this points to the same static memory structure. For
interpreters with their own obmalloc state, it is heap allocated. Add
free_obmalloc_arenas() which will free the obmalloc arenas and radix tree
structures for interpreters with their own obmalloc state.

..

.. date: 2023-06-06-19-09-00
.. gh-issue: 55664
.. nonce: vYYl0V
.. section: Core and Builtins

Add warning when creating :class:`type` using a namespace dictionary with
non-string keys. Patched by Daniel Urban and Furkan Onder.

..

.. date: 2023-05-16-06-52-34
.. gh-issue: 104530
.. nonce: mJnA0W
.. section: Core and Builtins

Use native Win32 condition variables.

..

.. date: 2024-02-13-18-27-03
.. gh-issue: 115392
.. nonce: gle5tp
.. section: Library

Fix a bug in :mod:`doctest` where incorrect line numbers would be reported
for decorated functions.

..

.. date: 2024-02-11-20-23-36
.. gh-issue: 114563
.. nonce: RzxNYT
.. section: Library

Fix several :func:`format` bugs when using the C implementation of
:class:`~decimal.Decimal`: * memory leak in some rare cases when using the
``z`` format option (coerce negative 0) * incorrect output when applying the
``z`` format option to type ``F`` (fixed-point with capital ``NAN`` /
``INF``) * incorrect output when applying the ``#`` format option (alternate
form)

..

.. date: 2024-02-10-15-24-20
.. gh-issue: 102840
.. nonce: 4mnDq1
.. section: Library

Fix confused traceback when floordiv, mod, or divmod operations happens
between instances of :class:`fractions.Fraction` and :class:`complex`.

..

.. date: 2024-02-09-07-20-16
.. gh-issue: 115165
.. nonce: yfJLXA
.. section: Library

Most exceptions are now ignored when attempting to set the
``__orig_class__`` attribute on objects returned when calling :mod:`typing`
generic aliases (including generic aliases created using
:data:`typing.Annotated`). Previously only :exc:`AttributeError` was
ignored. Patch by Dave Shawley.

..

.. date: 2024-02-08-17-04-58
.. gh-issue: 112903
.. nonce: SN_vUs
.. section: Library

Fix "issubclass() arg 1 must be a class" errors in certain cases of multiple
inheritance with generic aliases (regression in early 3.13 alpha releases).

..

.. date: 2024-02-08-14-21-28
.. gh-issue: 115133
.. nonce: ycl4ko
.. section: Library

Fix tests for :class:`~xml.etree.ElementTree.XMLPullParser` with Expat
2.6.0.

..

.. date: 2024-02-08-13-26-14
.. gh-issue: 115059
.. nonce: DqP9dr
.. section: Library

:meth:`io.BufferedRandom.read1` now flushes the underlying write buffer.

..

.. date: 2024-02-07-12-37-52
.. gh-issue: 79382
.. nonce: Yz_5WB
.. section: Library

Trailing ``**`` no longer allows to match files and non-existing paths in
recursive :func:`~glob.glob`.

..

.. date: 2024-02-06-15-16-28
.. gh-issue: 67837
.. nonce: _JKa73
.. section: Library

Avoid race conditions in the creation of directories during concurrent
extraction in :mod:`tarfile` and :mod:`zipfile`.

..

.. date: 2024-02-06-03-55-46
.. gh-issue: 115060
.. nonce: EkWRpP
.. section: Library

Speed up :meth:`pathlib.Path.glob` by removing redundant regex matching.

..

.. date: 2024-02-05-16-48-06
.. gh-issue: 97928
.. nonce: JZCies
.. section: Library

Partially revert the behavior of :meth:`tkinter.Text.count`. By default it
preserves the behavior of older Python versions, except that setting
``wantobjects`` to 0 no longer has effect. Add a new parameter
*return_ints*: specifying ``return_ints=True`` makes ``Text.count()`` always
returning the single count as an integer instead of a 1-tuple or ``None``.

..

.. date: 2024-02-04-13-17-33
.. gh-issue: 114628
.. nonce: WJpqqS
.. section: Library

When csv.Error is raised when handling TypeError, do not print the TypeError
traceback.

..

.. date: 2024-02-04-02-28-37
.. gh-issue: 85984
.. nonce: NHZVTQ
.. section: Library

Added ``_POSIX_VDISABLE`` from C's ``<unistd.h>`` to :mod:`termios`.

..

.. date: 2024-02-03-17-54-17
.. gh-issue: 114965
.. nonce: gHksCK
.. section: Library

Update bundled pip to 24.0

..

.. date: 2024-02-03-16-59-25
.. gh-issue: 114959
.. nonce: dCfAG2
.. section: Library

:mod:`tarfile` no longer ignores errors when trying to extract a directory
on top of a file.

..

.. date: 2024-02-02-15-50-13
.. gh-issue: 114894
.. nonce: DF-dSd
.. section: Library

Add :meth:`array.array.clear`.

..

.. date: 2024-02-01-10-19-11
.. gh-issue: 114071
.. nonce: vkm2G_
.. section: Library

Support tuple subclasses using auto() for enum member value.

..

.. date: 2024-01-31-20-07-11
.. gh-issue: 109475
.. nonce: lmTb9S
.. section: Library

Fix support of explicit option value "--" in :mod:`argparse` (e.g.
``--option=--``).

..

.. date: 2024-01-30-22-10-50
.. gh-issue: 49766
.. nonce: yulJL_
.. section: Library

Fix :class:`~datetime.date`-:class:`~datetime.datetime` comparison. Now the
special comparison methods like ``__eq__`` and ``__lt__`` return
:data:`NotImplemented` if one of comparands is :class:`!date` and other is
:class:`!datetime` instead of ignoring the time part and the time zone or
forcefully return "not equal" or raise :exc:`TypeError`. It makes comparison
of :class:`!date` and :class:`!datetime` subclasses more symmetric and
allows to change the default behavior by overriding the special comparison
methods in subclasses.

..

.. date: 2024-01-30-15-34-08
.. gh-issue: 110190
.. nonce: Z5PQQX
.. section: Library

Fix ctypes structs with array on Windows ARM64 platform by setting
``MAX_STRUCT_SIZE`` to 32 in stgdict. Patch by Diego Russo

..

.. date: 2024-01-28-19-40-40
.. gh-issue: 114678
.. nonce: kYKcJw
.. section: Library

Ensure that deprecation warning for 'N' specifier in
:class:`~decimal.Decimal` format is not raised for cases where 'N' appears
in other places in the format specifier. Based on patch by Stefan Krah.

..

.. date: 2024-01-28-18-38-18
.. gh-issue: 70303
.. nonce: _Lt_pj
.. section: Library

Return both files and directories from :meth:`pathlib.Path.glob` if a
pattern ends with "``**``". Previously only directories were returned.

..

.. date: 2024-01-28-00-48-12
.. gh-issue: 109653
.. nonce: vF4exe
.. section: Library

Improve import time of :mod:`importlib.metadata` and :mod:`email.utils`.

..

.. date: 2024-01-27-20-11-24
.. gh-issue: 113280
.. nonce: CZPQMf
.. section: Library

Fix a leak of open socket in rare cases when error occurred in
:class:`ssl.SSLSocket` creation.

..

.. date: 2024-01-26-16-46-21
.. gh-issue: 77749
.. nonce: NY_7TS
.. section: Library

:meth:`email.policy.EmailPolicy.fold` now always encodes non-ASCII
characters in headers if :attr:`~email.policy.EmailPolicy.utf8` is false.

..

.. date: 2024-01-25-19-22-17
.. gh-issue: 83383
.. nonce: 3GwO9v
.. section: Library

Synchronization of the :mod:`dbm.dumb` database is now no-op if there was no
modification since opening or last synchronization. The directory file for a
newly created empty :mod:`dbm.dumb` database is now created immediately
after opening instead of deferring this until synchronizing or closing.

..

.. date: 2024-01-24-20-51-49
.. gh-issue: 91602
.. nonce: 8fOH8l
.. section: Library

Add *filter* keyword-only parameter to :meth:`sqlite3.Connection.iterdump`
for filtering database objects to dump. Patch by Mariusz Felisiak.

..

.. date: 2024-01-24-20-11-46
.. gh-issue: 112451
.. nonce: 7YrG4p
.. section: Library

Prohibit subclassing pure-Python :class:`datetime.timezone`. This is
consistent with C-extension implementation. Patch by Mariusz Felisiak.

..

.. date: 2024-01-24-17-25-18
.. gh-issue: 69893
.. nonce: PQq5fR
.. section: Library

Add the :meth:`!close` method for the iterator returned by
:func:`xml.etree.ElementTree.iterparse`.

..

.. date: 2024-01-23-23-13-47
.. gh-issue: 109653
.. nonce: KLBHmT
.. section: Library

Reduce the import time of :mod:`threading` module by ~50%. Patch by Daniel
Hollas.

..

.. date: 2024-01-23-21-20-40
.. gh-issue: 114492
.. nonce: vKxl5o
.. section: Library

Make the result of :func:`termios.tcgetattr` reproducible on Alpine Linux.
Previously it could leave a random garbage in some fields.

..

.. date: 2024-01-23-14-11-49
.. gh-issue: 114315
.. nonce: KeVdzl
.. section: Library

Make :class:`threading.Lock` a real class, not a factory function. Add
``__new__`` to ``_thread.lock`` type.

..

.. date: 2024-01-23-13-03-22
.. gh-issue: 100414
.. nonce: 5kTdU5
.. section: Library

Add :mod:`dbm.sqlite3` as a backend to :mod:`dbm`, and make it the new
default :mod:`!dbm` backend. Patch by Raymond Hettinger and Erlend E.
Aasland.

..

.. date: 2024-01-23-11-04-21
.. gh-issue: 113267
.. nonce: xe_Pxe
.. section: Library

Revert changes in :gh:`106584` which made calls of ``TestResult`` methods
``startTest()`` and ``stopTest()`` unbalanced.

..

.. date: 2024-01-22-12-10-34
.. gh-issue: 75128
.. nonce: 4FGlRS
.. section: Library

Ignore an :exc:`OSError` in :meth:`asyncio.BaseEventLoop.create_server` when
IPv6 is available but the interface cannot actually support it.

..

.. date: 2024-01-22-11-43-38
.. gh-issue: 114423
.. nonce: 6mMoPH
.. section: Library

``_DummyThread`` entries in ``threading._active`` are now automatically
removed when the related thread dies.

..

.. date: 2024-01-21-16-32-55
.. gh-issue: 114257
.. nonce: bCFld5
.. section: Library

Dismiss the :exc:`FileNotFound` error in :func:`ctypes.util.find_library`
and just return ``None`` on Linux.

..

.. date: 2024-01-19-18-41-02
.. gh-issue: 114321
.. nonce: yj_Xw3
.. section: Library

Expose more platform specific constants in the :mod:`fcntl` module on Linux,
macOS, FreeBSD and NetBSD.

..

.. date: 2024-01-19-15-48-06
.. gh-issue: 114328
.. nonce: hixxW3
.. section: Library

The :func:`tty.setcbreak` and new :func:`tty.cfmakecbreak` no longer clears
the terminal input ICRLF flag. This fixes a regression introduced in 3.12
that no longer matched how OSes define cbreak mode in their ``stty(1)``
manual pages.

..

.. date: 2024-01-19-12-05-22
.. gh-issue: 114281
.. nonce: H5JQe4
.. section: Library

Remove type hints from ``Lib/asyncio/staggered.py``. The annotations in the
`typeshed <https://github.com/python/typeshed>`__ project should be used
instead.

..

.. date: 2024-01-18-22-29-28
.. gh-issue: 101438
.. nonce: 1-uUi_
.. section: Library

Avoid reference cycle in ElementTree.iterparse. The iterator returned by
``ElementTree.iterparse`` may hold on to a file descriptor. The reference
cycle prevented prompt clean-up of the file descriptor if the returned
iterator was not exhausted.

..

.. date: 2024-01-18-10-07-52
.. gh-issue: 114198
.. nonce: lK4Iif
.. section: Library

The signature for the ``__replace__`` method on :mod:`dataclasses` now has
the first argument named ``self``, rather than ``obj``.

..

.. date: 2024-01-17-18-53-51
.. gh-issue: 104522
.. nonce: 3NyDf4
.. section: Library

:exc:`OSError` raised when run a subprocess now only has *filename*
attribute set to *cwd* if the error was caused by a failed attempt to change
the current directory.

..

.. date: 2024-01-16-15-59-06
.. gh-issue: 114149
.. nonce: LJ8IPm
.. section: Library

Enum: correctly handle tuple subclasses in custom ``__new__``.

..

.. date: 2024-01-15-20-21-33
.. gh-issue: 83648
.. nonce: HzD_fY
.. section: Library

Support deprecation of options, positional arguments and subcommands in
:mod:`argparse`.

..

.. date: 2024-01-15-19-54-41
.. gh-issue: 114087
.. nonce: Xic5vY
.. section: Library

Speed up ``dataclasses.asdict`` up to 1.35x.

..

.. date: 2024-01-15-18-42-44
.. gh-issue: 109534
.. nonce: wYaLMZ
.. section: Library

Fix a reference leak in
:class:`asyncio.selector_events.BaseSelectorEventLoop` when SSL handshakes
fail. Patch contributed by Jamie Phan.

..

.. date: 2024-01-12-17-32-36
.. gh-issue: 79634
.. nonce: uTSTRI
.. section: Library

Accept :term:`path-like objects <path-like object>` as patterns in
:meth:`pathlib.Path.glob` and :meth:`~pathlib.Path.rglob`.

..

.. date: 2024-01-12-09-35-07
.. gh-issue: 112202
.. nonce: t_0V1m
.. section: Library

Ensure that a :func:`asyncio.Condition.notify` call does not get lost if the
awakened ``Task`` is simultaneously cancelled or encounters any other error.

..

.. date: 2024-01-11-20-47-49
.. gh-issue: 113951
.. nonce: AzlqFK
.. section: Library

Fix the behavior of ``tag_unbind()`` methods of :class:`tkinter.Text` and
:class:`tkinter.Canvas` classes with three arguments. Previously,
``widget.tag_unbind(tag, sequence, funcid)`` destroyed the current binding
for *sequence*, leaving *sequence* unbound, and deleted the *funcid*
command. Now it removes only *funcid* from the binding for *sequence*,
keeping other commands, and deletes the *funcid* command. It leaves
*sequence* unbound only if *funcid* was the last bound command.

..

.. date: 2024-01-11-15-10-53
.. gh-issue: 97959
.. nonce: UOj6d4
.. section: Library

Fix rendering class methods, bound methods, method and function aliases in
:mod:`pydoc`. Class methods no longer have "method of builtins.type
instance" note. Corresponding notes are now added for class and unbound
methods. Method and function aliases now have references to the module or
the class where the origin was defined if it differs from the current. Bound
methods are now listed in the static methods section. Methods of builtin
classes are now supported as well as methods of Python classes.

..

.. date: 2024-01-07-21-04-24
.. gh-issue: 113796
.. nonce: 6iNsCR
.. section: Library

Add more validation checks in the :class:`csv.Dialect` constructor.
:exc:`ValueError` is now raised if the same character is used in different
roles.

..

.. date: 2024-01-05-16-27-34
.. gh-issue: 113732
.. nonce: fgDRXA
.. section: Library

Fix support of :data:`~csv.QUOTE_NOTNULL` and :data:`~csv.QUOTE_STRINGS` in
:func:`csv.reader`.

..

.. date: 2024-01-04-20-58-17
.. gh-issue: 113225
.. nonce: -nyJM4
.. section: Library

Speed up :meth:`pathlib.Path.walk` by using :attr:`os.DirEntry.path` where
possible.

..

.. date: 2023-12-18-20-10-50
.. gh-issue: 89039
.. nonce: gqFdtU
.. section: Library

When replace() method is called on a subclass of datetime, date or time,
properly call derived constructor. Previously, only the base class's
constructor was called.

Also, make sure to pass non-zero fold values when creating subclasses in
various methods. Previously, fold was silently ignored.

..

.. date: 2023-12-09-23-31-17
.. gh-issue: 112919
.. nonce: S5k9QN
.. section: Library

Speed-up :func:`datetime.datetime.replace`, :func:`datetime.date.replace`
and :func:`datetime.time.replace`.

..

.. date: 2023-11-27-19-54-43
.. gh-issue: 59013
.. nonce: chpQ0e
.. section: Library

Set breakpoint on the first executable line of the function, instead of the
line of function definition when the user do ``break func`` using :mod:`pdb`

..

.. date: 2023-11-24-19-08-50
.. gh-issue: 112343
.. nonce: RarGFC
.. section: Library

Improve handling of pdb convenience variables to avoid replacing string
contents.

..

.. date: 2023-11-18-16-30-21
.. gh-issue: 112240
.. nonce: YXS0tj
.. section: Library

Add option to calendar module CLI to specify the weekday to start each week.
Patch by Steven Ward.

..

.. date: 2023-11-04-22-32-27
.. gh-issue: 111741
.. nonce: f1ufr8
.. section: Library

Recognise ``image/webp`` as a standard format in the :mod:`mimetypes`
module.

..

.. date: 2023-10-27-19-24-58
.. gh-issue: 43457
.. nonce: 84lx9H
.. section: Library

Fix the :mod:`tkinter` widget method :meth:`!wm_attributes`. It now accepts
the attribute name without the minus prefix to get window attributes and
allows to specify attributes and values to set as keyword arguments. Add new
optional keyword argument *return_python_dict*: calling
``w.wm_attributes(return_python_dict=True)`` returns the attributes as a
dict instead of a tuple. Calling ``w.wm_attributes()`` now returns a tuple
instead of string if *wantobjects* was set to 0.

..

.. date: 2023-10-24-19-19-54
.. gh-issue: 82626
.. nonce: _hfLRf
.. section: Library

Many functions now emit a warning if a boolean value is passed as a file
descriptor argument.

..

.. date: 2023-10-19-02-08-12
.. gh-issue: 111051
.. nonce: 8h1Dpk
.. section: Library

Added check for file modification during debugging with :mod:`pdb`

..

.. date: 2023-10-04-11-09-30
.. gh-issue: 110345
.. nonce: fZU1ud
.. section: Library

Show the Tcl/Tk patchlevel (rather than version) in :meth:`tkinter._test`.

..

.. date: 2023-09-22-22-17-45
.. gh-issue: 38807
.. nonce: m9McRN
.. section: Library

Fix race condition in :mod:`trace`. Instead of checking if a directory
exists and creating it, directly call :func:`os.makedirs` with the kwarg
``exist_ok=True``.

..

.. date: 2023-07-23-12-28-26
.. gh-issue: 75705
.. nonce: aB2-Ww
.. section: Library

Set unixfrom envelope in :class:`mailbox.mbox` and :class:`mailbox.MMDF`.

..

.. date: 2023-06-29-14-26-56
.. gh-issue: 106233
.. nonce: Aqw2HI
.. section: Library

Fix stacklevel in ``InvalidTZPathWarning`` during :mod:`zoneinfo` module
import.

..

.. date: 2023-05-30-18-30-11
.. gh-issue: 105102
.. nonce: SnpK04
.. section: Library

Allow :class:`ctypes.Union` to be nested in :class:`ctypes.Structure` when
the system endianness is the opposite of the classes.

..

.. date: 2023-05-08-09-30-00
.. gh-issue: 104282
.. nonce: h4c6Eb
.. section: Library

Fix null pointer dereference in :func:`lzma._decode_filter_properties` due
to improper handling of BCJ filters with properties of zero length. Patch by
Radislav Chugunov.

..

.. date: 2023-05-06-04-57-10
.. gh-issue: 96471
.. nonce: C9wAU7
.. section: Library

Add :py:class:`queue.Queue` termination with
:py:meth:`~queue.Queue.shutdown`.

..

.. date: 2023-04-08-11-41-07
.. gh-issue: 101599
.. nonce: PaWNFh
.. section: Library

Changed argparse flag options formatting to remove redundancy.

..

.. date: 2023-03-15-03-21-18
.. gh-issue: 85984
.. nonce: Xaq6ZN
.. section: Library

Add POSIX pseudo-terminal functions :func:`os.posix_openpt`,
:func:`os.grantpt`, :func:`os.unlockpt`, and :func:`os.ptsname`.

..

.. date: 2023-03-08-00-02-30
.. gh-issue: 102512
.. nonce: LiugDr
.. section: Library

When :func:`os.fork` is called from a foreign thread (aka ``_DummyThread``),
the type of the thread in a child process is changed to ``_MainThread``.
Also changed its name and daemonic status, it can be now joined.

..

.. date: 2022-07-31-01-24-40
.. gh-issue: 88569
.. nonce: eU0--b
.. section: Library

Add :func:`os.path.isreserved`, which identifies reserved pathnames such as
"NUL", "AUX" and "CON". This function is only available on Windows.

Deprecate :meth:`pathlib.PurePath.is_reserved`.

..

.. bpo: 38364
.. date: 2019-10-05-22-56-50
.. nonce: sYTCWF
.. section: Library

The ``inspect`` functions ``isgeneratorfunction``, ``iscoroutinefunction``,
``isasyncgenfunction`` now support ``functools.partialmethod`` wrapped
functions the same way they support ``functools.partial``.

..

.. date: 2024-02-12-12-26-17
.. gh-issue: 115233
.. nonce: aug6r9
.. section: Documentation

Fix an example for :class:`~logging.LoggerAdapter` in the Logging Cookbook.

..

.. date: 2024-01-17-11-40-03
.. gh-issue: 114123
.. nonce: LuueXf
.. section: Documentation

Move the :mod:`csv` module docstring to the :mod:`!csv` module instead of
reexporting it from the internal :mod:`!_csv` module, and remove ``__doc__``
from ``csv.__all__``.

Move :attr:`!csv.__version__` to the :mod:`!csv` module instead of
reexporting it from the internal :mod:`!_csv` module, and remove
``__version__`` from ``csv.__all__``.

..

.. date: 2024-02-02-13-18-55
.. gh-issue: 114099
.. nonce: C_ycWg
.. section: Tests

Added test exclusions required to run the test suite on iOS.

..

.. date: 2023-06-02-05-04-15
.. gh-issue: 105089
.. nonce: KaZFtU
.. section: Tests

Fix
``test.test_zipfile.test_core.TestWithDirectory.test_create_directory_with_write``
test in AIX by doing a bitwise AND of 0xFFFF on mode , so that it will be in
sync with ``zinfo.external_attr``

..

.. date: 2024-02-08-19-36-20
.. gh-issue: 115167
.. nonce: LB9nDK
.. section: Build

Avoid vendoring ``vcruntime140_threads.dll`` when building with Visual
Studio 2022 version 17.8.

..

.. date: 2024-02-08-17-38-56
.. gh-issue: 113632
.. nonce: y9KIGb
.. section: Build

Promote WASI to a tier 2 platform and drop Emscripten from tier 3 in
configure.ac.

..

.. date: 2024-02-07-08-23-48
.. gh-issue: 114099
.. nonce: XcEXEZ
.. section: Build

configure and Makefile were refactored to accommodate framework builds on
Apple platforms other than macOS.

..

.. date: 2024-02-01-20-08-11
.. gh-issue: 114875
.. nonce: x_2iZ9
.. section: Build

Add :c:func:`!getgrent` as a prerequisite for building the :mod:`grp`
module.

..

.. date: 2024-02-08-21-37-22
.. gh-issue: 115049
.. nonce: X1ObpJ
.. section: Windows

Fixes ``py.exe`` launcher failing when run as users without user profiles.

..

.. date: 2024-02-06-09-05-13
.. gh-issue: 115009
.. nonce: ShMjZs
.. section: Windows

Update Windows installer to use SQLite 3.45.1.

..

.. date: 2024-02-05-16-53-12
.. gh-issue: 109991
.. nonce: YqjnDz
.. section: Windows

Update Windows build to use OpenSSL 3.0.13.

..

.. date: 2024-02-01-14-35-05
.. gh-issue: 111239
.. nonce: SO7SUF
.. section: Windows

Update Windows builds to use zlib v1.3.1.

..

.. date: 2024-01-23-00-05-05
.. gh-issue: 100107
.. nonce: lkbP_Q
.. section: Windows

The ``py.exe`` launcher will no longer attempt to run the Microsoft Store
redirector when launching a script containing a ``/usr/bin/env`` shebang

..

.. date: 2023-12-19-22-32-28
.. gh-issue: 112984
.. nonce: F7kFMl
.. section: Windows

Adds free-threaded binaries to Windows installer as an optional component.

..

.. date: 2023-08-11-18-21-38
.. gh-issue: 89240
.. nonce: dtSOLG
.. section: Windows

Allows :mod:`multiprocessing` to create pools of greater than 62 processes.

..

.. date: 2024-02-06-09-01-10
.. gh-issue: 115009
.. nonce: ysau7e
.. section: macOS

Update macOS installer to use SQLite 3.45.1.

..

.. date: 2024-02-05-18-30-27
.. gh-issue: 109991
.. nonce: tun6Yu
.. section: macOS

Update macOS installer to use OpenSSL 3.0.13.

..

.. date: 2024-01-23-11-35-26
.. gh-issue: 114490
.. nonce: FrQOQ0
.. section: macOS

Add Mach-O linkage support for :func:`platform.architecture`.

..

.. date: 2022-11-18-10-05-35
.. gh-issue: 87804
.. nonce: rhlDmD
.. section: macOS

On macOS the result of ``os.statvfs`` and ``os.fstatvfs`` now correctly
report the size of very large disks, in previous versions the reported
number of blocks was wrong for disks with at least 2**32 blocks.

..

.. date: 2024-01-17-23-18-15
.. gh-issue: 96905
.. nonce: UYaxoU
.. section: IDLE

In idlelib code, stop redefining built-ins 'dict' and 'object'.

..

.. date: 2023-04-25-03-01-23
.. gh-issue: 103820
.. nonce: LCSpza
.. section: IDLE

Revise IDLE bindings so that events from mouse button 4/5 on non-X11
windowing systems (i.e. Win32 and Aqua) are not mistaken for scrolling.

..

.. date: 2024-02-14-15-58-13
.. gh-issue: 113516
.. nonce: TyIHWx
.. section: Tools/Demos

Don't set ``LDSHARED`` when building for WASI.

..

.. date: 2024-02-05-19-00-32
.. gh-issue: 109991
.. nonce: yJSEkw
.. section: Tools/Demos

Update GitHub CI workflows to use OpenSSL 3.0.13 and multissltests to use
1.1.1w, 3.0.13, 3.1.5, and 3.2.1.

..

.. date: 2024-02-05-02-45-51
.. gh-issue: 115015
.. nonce: rgtiDB
.. section: Tools/Demos

Fix a bug in Argument Clinic that generated incorrect code for methods with
no parameters that use the :ref:`METH_METHOD | METH_FASTCALL | METH_KEYWORDS
<METH_METHOD-METH_FASTCALL-METH_KEYWORDS>` calling convention. Only the
positional parameter count was checked; any keyword argument passed would be
silently accepted.

..

.. date: 2024-02-05-17-11-15
.. gh-issue: 111140
.. nonce: WMEjid
.. section: C API

Adds :c:func:`PyLong_AsNativeBytes`, :c:func:`PyLong_FromNativeBytes` and
:c:func:`PyLong_FromUnsignedNativeBytes` functions.

..

.. date: 2024-01-31-15-43-35
.. gh-issue: 114685
.. nonce: n7aRmX
.. section: C API

:c:func:`PyBuffer_FillInfo` now raises a :exc:`SystemError` if called with
:c:macro:`PyBUF_READ` or :c:macro:`PyBUF_WRITE` as flags. These flags should
only be used with the ``PyMemoryView_*`` C API.

..

.. date: 2024-01-29-12-13-24
.. gh-issue: 114685
.. nonce: B07RME
.. section: C API

:c:func:`PyObject_GetBuffer` now raises a :exc:`SystemError` if called with
:c:macro:`PyBUF_READ` or :c:macro:`PyBUF_WRITE` as flags. These flags should
only be used with the ``PyMemoryView_*`` C API.

..

.. date: 2024-01-26-21-54-42
.. gh-issue: 114626
.. nonce: SKhbh_
.. section: C API

Add ``PyCFunctionFast`` and ``PyCFunctionFastWithKeywords`` typedefs
(identical to the existing ``_PyCFunctionFast`` and
``_PyCFunctionFastWithKeywords`` typedefs, just without a leading ``_``
prefix).

..

.. date: 2024-01-23-21-45-02
.. gh-issue: 114329
.. nonce: YRaBoe
.. section: C API

Add :c:func:`PyList_GetItemRef`, which is similar to
:c:func:`PyList_GetItem` but returns a :term:`strong reference` instead of a
:term:`borrowed reference`.

..

.. date: 2023-11-16-02-07-48
.. gh-issue: 110850
.. nonce: DQGNfF
.. section: C API

Add PyTime C API:

* :c:type:`PyTime_t` type.
* :c:var:`PyTime_MIN` and :c:var:`PyTime_MAX` constants.
* :c:func:`PyTime_AsSecondsDouble`,
  :c:func:`PyTime_Monotonic`, :c:func:`PyTime_PerfCounter`, and
  :c:func:`PyTime_Time` functions.

Patch by Victor Stinner.

..

.. date: 2023-11-15-13-47-48
.. gh-issue: 112066
.. nonce: 22WsqR
.. section: C API

Add :c:func:`PyDict_SetDefaultRef`: insert a key and value into a dictionary
if the key is not already present. This is similar to
:meth:`dict.setdefault`, but returns an integer value indicating if the key
was already present. It is also similar to :c:func:`PyDict_SetDefault`, but
returns a strong reference instead of a borrowed reference.


================================================
File: /Misc/NEWS.d/3.13.0a5.rst
================================================
.. date: 2024-02-18-03-14-40
.. gh-issue: 115398
.. nonce: tzvxH8
.. release date: 2024-03-12
.. section: Security

Allow controlling Expat >=2.6.0 reparse deferral (:cve:`2023-52425`) by adding
five new methods:

* :meth:`xml.etree.ElementTree.XMLParser.flush`
* :meth:`xml.etree.ElementTree.XMLPullParser.flush`
* :meth:`xml.parsers.expat.xmlparser.GetReparseDeferralEnabled`
* :meth:`xml.parsers.expat.xmlparser.SetReparseDeferralEnabled`
* :meth:`xml.sax.expatreader.ExpatParser.flush`

..

.. date: 2024-01-26-22-14-09
.. gh-issue: 114572
.. nonce: t1QMQD
.. section: Security

:meth:`ssl.SSLContext.cert_store_stats` and
:meth:`ssl.SSLContext.get_ca_certs` now correctly lock access to the
certificate store, when the :class:`ssl.SSLContext` is shared across
multiple threads.

..

.. date: 2024-03-11-22-24-59
.. gh-issue: 116604
.. nonce: LCEzAT
.. section: Core and Builtins

Respect the status of the garbage collector when indirect calls are made via
:c:func:`PyErr_CheckSignals` and the evaluation breaker. Patch by Pablo
Galindo

..

.. date: 2024-03-09-11-10-53
.. gh-issue: 112087
.. nonce: nbI0Pw
.. section: Core and Builtins

:class:`list` is now compatible with the implementation of :pep:`703`.

..

.. date: 2024-03-05-22-00-58
.. gh-issue: 116381
.. nonce: 0Nq9iO
.. section: Core and Builtins

Add specialization for ``CONTAINS_OP``.

..

.. date: 2024-03-04-10-19-51
.. gh-issue: 116296
.. nonce: gvtxyU
.. section: Core and Builtins

Fix possible refleak in :meth:`!object.__reduce__` internal error handling.

..

.. date: 2024-02-22-16-17-53
.. gh-issue: 115823
.. nonce: c1TreJ
.. section: Core and Builtins

Properly calculate error ranges in the parser when raising
:exc:`SyntaxError` exceptions caused by invalid byte sequences. Patch by
Pablo Galindo

..

.. date: 2024-02-22-11-33-20
.. gh-issue: 115778
.. nonce: jksd1D
.. section: Core and Builtins

Add ``tierN`` annotation for instruction definition in interpreter DSL.

..

.. date: 2024-02-20-18-49-02
.. gh-issue: 115733
.. nonce: 51Zb85
.. section: Core and Builtins

Fix crash when calling ``next()`` on exhausted list iterators.

..

.. date: 2024-02-20-12-46-20
.. gh-issue: 115700
.. nonce: KLJ5r4
.. section: Core and Builtins

The regen-cases build stage now works on Windows.

..

.. date: 2024-02-14-23-50-43
.. gh-issue: 115347
.. nonce: VkHvQC
.. section: Core and Builtins

Fix bug where docstring was replaced by a redundant NOP when Python is run
with ``-OO``.

..

.. date: 2024-02-12-23-29-17
.. gh-issue: 115323
.. nonce: 3t6687
.. section: Core and Builtins

Make error message more meaningful for when :meth:`bytearray.extend` is
called with a :class:`str` object.

..

.. date: 2024-02-09-18-59-22
.. gh-issue: 112175
.. nonce: qglugr
.. section: Core and Builtins

Every ``PyThreadState`` now has its own ``eval_breaker``, allowing specific
threads to be interrupted.

..

.. date: 2024-02-08-16-01-18
.. gh-issue: 115154
.. nonce: ji96FV
.. section: Core and Builtins

Fix a bug that was causing the :func:`tokenize.untokenize` function to
handle unicode named literals incorrectly. Patch by Pablo Galindo

..

.. date: 2024-01-28-02-46-12
.. gh-issue: 112433
.. nonce: FUX-nT
.. section: Core and Builtins

Add ability to force alignment of :mod:`ctypes.Structure` by way of the new
``_align_`` attribute on the class.

..

.. date: 2023-07-16-15-02-47
.. gh-issue: 104090
.. nonce: oMjNa9
.. section: Core and Builtins

The multiprocessing resource tracker now exits with non-zero status code if
a resource leak was detected. It still exits with status code 0 otherwise.

..

.. date: 2023-06-16-21-29-06
.. gh-issue: 105858
.. nonce: Q7h0EV
.. section: Core and Builtins

Improve the constructors for :mod:`ast` nodes. Arguments of list types now
default to an empty list if omitted, and optional fields default to
``None``. AST nodes now have an ``__annotations__`` attribute with the
expected types of their attributes. Passing unrecognized extra arguments to
AST nodes is deprecated and will become an error in Python 3.15. Omitting a
required argument to an AST node is deprecated and will become an error in
Python 3.15. Patch by Jelle Zijlstra.

..

.. date: 2023-02-13-11-36-50
.. gh-issue: 101860
.. nonce: CKCMbC
.. section: Core and Builtins

Expose ``__name__`` attribute on property.

..

.. date: 2022-09-04-16-51-56
.. gh-issue: 96497
.. nonce: HTBuIL
.. section: Core and Builtins

Fix incorrect resolution of mangled class variables used in assignment
expressions in comprehensions.

..

.. date: 2024-03-11-12-11-10
.. gh-issue: 116600
.. nonce: FcNBy_
.. section: Library

Fix :func:`repr` for global :class:`~enum.Flag` members.

..

.. date: 2024-03-07-21-57-50
.. gh-issue: 116349
.. nonce: fD2pbP
.. section: Library

:func:`platform.java_ver` is deprecated and will be removed in 3.15. It was
largely untested, had a confusing API, and was only useful for Jython
support.

..

.. date: 2024-03-05-20-53-34
.. gh-issue: 116143
.. nonce: sww6Zl
.. section: Library

Fix a race in pydoc ``_start_server``, eliminating a window in which
``_start_server`` can return a thread that is "serving" but without a
``docserver`` set.

..

.. date: 2024-03-05-14-34-22
.. gh-issue: 116127
.. nonce: 5uktu3
.. section: Library

:mod:`typing`: implement :pep:`705` which adds :data:`typing.ReadOnly`
support to :class:`typing.TypedDict`.

..

.. date: 2024-03-05-02-09-18
.. gh-issue: 116325
.. nonce: FmlBYv
.. section: Library

:mod:`typing`: raise :exc:`SyntaxError` instead of :exc:`AttributeError` on
forward references as empty strings.

..

.. date: 2024-03-02-11-31-49
.. gh-issue: 115957
.. nonce: C-3Z_U
.. section: Library

When ``asyncio.TaskGroup.create_task`` is called on an inactive
``asyncio.TaskGroup``, the given coroutine will be closed (which prevents a
``RuntimeWarning``).

..

.. date: 2024-03-01-14-22-08
.. gh-issue: 115978
.. nonce: r2ePTo
.. section: Library

Disable preadv(), readv(), pwritev(), and writev() on WASI.

Under wasmtime for WASI 0.2, these functions don't pass test_posix
(https://github.com/bytecodealliance/wasmtime/issues/7830).

..

.. date: 2024-03-01-11-57-32
.. gh-issue: 88352
.. nonce: bZ68rw
.. section: Library

Fix the computation of the next rollover time in the
:class:`logging.TimedRotatingFileHandler` handler. :meth:`!computeRollover`
now always returns a timestamp larger than the specified time and works
correctly during the DST change. :meth:`!doRollover` no longer overwrite the
already rolled over file, saving from data loss when run at midnight or
during repeated time at the DST change.

..

.. date: 2024-02-29-20-06-06
.. gh-issue: 87115
.. nonce: FVMiOR
.. section: Library

Set ``__main__.__spec__`` to ``None`` when running a script with :mod:`pdb`

..

.. date: 2024-02-29-17-06-54
.. gh-issue: 76511
.. nonce: WqjRLP
.. section: Library

Fix UnicodeEncodeError in :meth:`email.Message.as_string` that results when
a message that claims to be in the ascii character set actually has
non-ascii characters. Non-ascii characters are now replaced with the U+FFFD
replacement character, like in the ``replace`` error handler.

..

.. date: 2024-02-28-17-50-42
.. gh-issue: 89547
.. nonce: GetF38
.. section: Library

Add support for nested typing special forms like Final[ClassVar[int]].

..

.. date: 2024-02-28-17-04-28
.. gh-issue: 65824
.. nonce: gG8KR1
.. section: Library

Improve the ``less`` prompt in :mod:`pydoc`.

..

.. date: 2024-02-28-13-10-17
.. gh-issue: 116040
.. nonce: wDidHd
.. section: Library

[Enum] fix by-value calls when second value is falsey; e.g. Cardinal(1, 0)

..

.. date: 2024-02-28-12-14-31
.. gh-issue: 115821
.. nonce: YO2vKA
.. section: Library

[Enum] Improve error message when calling super().__new__() in custom
__new__.

..

.. date: 2024-02-27-20-11-29
.. gh-issue: 85644
.. nonce: 3rgcBm
.. section: Library

Use the ``XDG_CURRENT_DESKTOP`` environment variable in :mod:`webbrowser` to
check desktop. Prefer it to the deprecated ``GNOME_DESKTOP_SESSION_ID`` for
GNOME detection.

..

.. date: 2024-02-27-13-05-51
.. gh-issue: 75988
.. nonce: In6LlB
.. section: Library

Fixed :func:`unittest.mock.create_autospec` to pass the call through to the
wrapped object to return the real result.

..

.. date: 2024-02-25-19-20-05
.. gh-issue: 115881
.. nonce: ro_Kuw
.. section: Library

Fix issue where :func:`ast.parse` would incorrectly flag conditional context
managers (such as ``with (x() if y else z()): ...``) as invalid syntax if
``feature_version=(3, 8)`` was passed. This reverts changes to the grammar
made as part of gh-94949.

..

.. date: 2024-02-24-18-48-14
.. gh-issue: 115886
.. nonce: rgM6AF
.. section: Library

Fix silent truncation of the name with an embedded null character in
:class:`multiprocessing.shared_memory.SharedMemory`.

..

.. date: 2024-02-23-11-08-31
.. gh-issue: 115532
.. nonce: zVd3gK
.. section: Library

Add kernel density estimation to the statistics module.

..

.. date: 2024-02-22-12-10-18
.. gh-issue: 115714
.. nonce: P2JsU1
.. section: Library

On WASI, the :mod:`time` module no longer get process time using ``times()``
or ``CLOCK_PROCESS_CPUTIME_ID``, system API is that is unreliable and is
likely to be removed from WASI. The affected clock functions fall back to
calling ``clock()``.

..

.. date: 2024-02-22-11-29-27
.. gh-issue: 115809
.. nonce: 9H1DhB
.. section: Library

Improve algorithm for computing which rolled-over log files to delete in
:class:`logging.TimedRotatingFileHandler`. It is now reliable for handlers
without ``namer`` and with arbitrary deterministic ``namer`` that leaves the
datetime part in the file name unmodified.

..

.. date: 2024-02-21-17-54-59
.. gh-issue: 74668
.. nonce: JT-Q8W
.. section: Library

:mod:`urllib.parse` functions :func:`~urllib.parse.parse_qs` and
:func:`~urllib.parse.parse_qsl` now support bytes arguments containing raw
and percent-encoded non-ASCII data.

..

.. date: 2024-02-20-22-02-34
.. gh-issue: 67044
.. nonce: QF9_Ru
.. section: Library

:func:`csv.writer` now always quotes or escapes ``'\r'`` and ``'\n'``,
regardless of *lineterminator* value.

..

.. date: 2024-02-20-16-42-54
.. gh-issue: 115712
.. nonce: EXVMXw
.. section: Library

Restore support of space delimiter with ``skipinitialspace=True`` in
:mod:`csv`. :func:`csv.writer` now quotes empty fields if delimiter is a
space and skipinitialspace is true and raises exception if quoting is not
possible.

..

.. date: 2024-02-20-07-38-15
.. gh-issue: 112364
.. nonce: EX7uGI
.. section: Library

Fixed :func:`ast.unparse` to handle format_spec with ``"``, ``'`` or ``\\``.
Patched by Frank Hoffmann.

..

.. date: 2024-02-19-16-53-48
.. gh-issue: 112997
.. nonce: sYBXRZ
.. section: Library

Stop logging potentially sensitive callback arguments in :mod:`asyncio`
unless debug mode is active.

..

.. date: 2024-02-19-15-52-30
.. gh-issue: 114914
.. nonce: M5-1d8
.. section: Library

Fix an issue where an abandoned :class:`StreamWriter` would not be garbage
collected.

..

.. date: 2024-02-18-12-18-12
.. gh-issue: 111358
.. nonce: 9yJUMD
.. section: Library

Fix a bug in :meth:`asyncio.BaseEventLoop.shutdown_default_executor` to
ensure the timeout passed to the coroutine behaves as expected.

..

.. date: 2024-02-17-18-47-12
.. gh-issue: 115618
.. nonce: napiNp
.. section: Library

Fix improper decreasing the reference count for ``None`` argument in
:class:`property` methods :meth:`~property.getter`, :meth:`~property.setter`
and :meth:`~property.deleter`.

..

.. date: 2024-02-16-16-40-10
.. gh-issue: 112720
.. nonce: io6_Ac
.. section: Library

Refactor :class:`dis.ArgResolver` to make it possible to subclass and change
the way jump args are interpreted.

..

.. date: 2024-02-15-23-42-54
.. gh-issue: 112006
.. nonce: 4wxcK-
.. section: Library

Fix :func:`inspect.unwrap` for types with the ``__wrapper__`` data
descriptor. Fix :meth:`inspect.Signature.from_callable` for builtins
:func:`classmethod` and :func:`staticmethod`.

..

.. date: 2024-02-15-19-11-49
.. gh-issue: 101293
.. nonce: 898b8l
.. section: Library

Support callables with the ``__call__()`` method and types with
``__new__()`` and ``__init__()`` methods set to class methods, static
methods, bound methods, partial functions, and other types of methods and
descriptors in :meth:`inspect.Signature.from_callable`.

..

.. date: 2024-02-12-11-42-48
.. gh-issue: 103092
.. nonce: sGMKr0
.. section: Library

Isolate :mod:`!_lsprof` (apply :pep:`687`).

..

.. date: 2024-02-11-20-12-39
.. gh-issue: 113942
.. nonce: i72sMJ
.. section: Library

:mod:`pydoc` no longer skips global functions implemented as builtin
methods, such as :class:`~type.MethodDescriptorType` and
:class:`~type.WrapperDescriptorType`.

..

.. date: 2024-02-10-17-18-49
.. gh-issue: 115256
.. nonce: 41Fy9P
.. section: Library

Added DeprecationWarning when accessing the tarfile attribute of TarInfo
objects. The attribute is never used internally and is only attached to
TarInfos when the tarfile is opened in write-mode, not read-mode. The
attribute creates an unnecessary reference cycle which may cause corruption
when not closing the handle after writing a tarfile.

..

.. date: 2024-02-09-19-41-48
.. gh-issue: 115197
.. nonce: 20wkWH
.. section: Library

``urllib.request`` no longer resolves the hostname before checking it
against the system's proxy bypass list on macOS and Windows.

..

.. date: 2024-02-09-12-22-47
.. gh-issue: 113812
.. nonce: wOraaG
.. section: Library

:meth:`DatagramTransport.sendto` will now send zero-length datagrams if
called with an empty bytes object. The transport flow control also now
accounts for the datagram header when calculating the buffer size.

..

.. date: 2024-01-30-23-28-29
.. gh-issue: 114763
.. nonce: BRjKkg
.. section: Library

Protect modules loaded with :class:`importlib.util.LazyLoader` from race
conditions when multiple threads try to access attributes before the loading
is complete.

..

.. date: 2024-01-29-13-46-41
.. gh-issue: 114709
.. nonce: SQ998l
.. section: Library

:func:`posixpath.commonpath` now raises a :exc:`ValueError` exception when
passed an empty iterable. Previously, :exc:`IndexError` was raised.

:func:`posixpath.commonpath` now raises a :exc:`TypeError` exception when
passed ``None``. Previously, :exc:`ValueError` was raised.

..

.. date: 2024-01-26-16-42-31
.. gh-issue: 114610
.. nonce: S18Vuz
.. section: Library

Fix bug where :meth:`pathlib.PurePath.with_stem` converted a non-empty path
suffix to a stem when given an empty *stem* argument. It now raises
:exc:`ValueError`, just like :meth:`pathlib.PurePath.with_suffix` does when
called on a path with an empty stem, given a non-empty *suffix* argument.

..

.. date: 2023-11-24-23-40-00
.. gh-issue: 107361
.. nonce: v54gh46
.. section: Library

Add :data:`ssl.VERIFY_X509_PARTIAL_CHAIN` and :data:`VERIFY_X509_STRICT` to
the default SSL context created with :func:`ssl.create_default_context`.

..

.. date: 2023-11-20-16-15-44
.. gh-issue: 112281
.. nonce: gH4EVk
.. section: Library

Allow creating :ref:`union of types<types-union>` for
:class:`typing.Annotated` with unhashable metadata.

..

.. date: 2023-11-07-10-22-06
.. gh-issue: 111775
.. nonce: IoVxfX
.. section: Library

Fix :meth:`importlib.resources.simple.ResourceHandle.open` for text mode,
added missed ``stream`` argument.

..

.. date: 2023-10-07-06-15-13
.. gh-issue: 90095
.. nonce: gWn1ka
.. section: Library

Make .pdbrc and -c work with any valid pdb commands.

..

.. date: 2023-08-05-08-41-58
.. gh-issue: 107625
.. nonce: cVSHCT
.. section: Library

Raise :exc:`configparser.ParsingError` from
:meth:`~configparser.ConfigParser.read` and
:meth:`~configparser.ConfigParser.read_file` methods of
:class:`configparser.ConfigParser` if a key without a corresponding value is
continued (that is, followed by an indented line).

..

.. date: 2023-08-02-01-17-32
.. gh-issue: 107155
.. nonce: Mj1K9L
.. section: Library

Fix incorrect output of ``help(x)`` where ``x`` is a :keyword:`lambda`
function, which has an ``__annotations__`` dictionary attribute with a
``"return"`` key.

..

.. date: 2023-07-12-14-52-04
.. gh-issue: 57141
.. nonce: L2k8Xb
.. section: Library

Add option for *non-shallow* comparisons to :class:`filecmp.dircmp` like
:func:`filecmp.cmp`. Original patch by Steven Ward. Enhanced by Tobias
Rautenkranz

..

.. date: 2023-05-17-21-33-21
.. gh-issue: 69990
.. nonce: Blvz9G
.. section: Library

:meth:`Profile.print_stats` has been improved to accept multiple sort
arguments. Patched by Chiu-Hsiang Hsu and Furkan Onder.

..

.. date: 2023-05-01-22-28-57
.. gh-issue: 104061
.. nonce: vxfBXf
.. section: Library

Add :data:`socket.SO_BINDTOIFINDEX` constant.

..

.. date: 2023-04-02-21-20-35
.. gh-issue: 60346
.. nonce: 7mjgua
.. section: Library

Fix ArgumentParser inconsistent with parse_known_args.

..

.. date: 2023-03-03-09-05-42
.. gh-issue: 102389
.. nonce: ucmo0_
.. section: Library

Add ``windows_31j`` to aliases for ``cp932`` codec

..

.. date: 2023-02-14-17-19-59
.. gh-issue: 72249
.. nonce: fv35wU
.. section: Library

:func:`functools.partial`s of :func:`repr` has been improved to include the
:term:`module` name. Patched by Furkan Onder and Anilyka Barry.

..

.. date: 2023-01-12-14-16-01
.. gh-issue: 100985
.. nonce: GT5Fvd
.. section: Library

Update HTTPSConnection to consistently wrap IPv6 Addresses when using a
proxy.

..

.. date: 2023-01-09-14-08-02
.. gh-issue: 100884
.. nonce: DcmdLl
.. section: Library

email: fix misfolding of comma in address-lists over multiple lines in
combination with unicode encoding.

..

.. date: 2022-11-22-23-17-43
.. gh-issue: 95782
.. nonce: an_and
.. section: Library

Fix :func:`io.BufferedReader.tell`, :func:`io.BufferedReader.seek`,
:func:`!_pyio.BufferedReader.tell`, :func:`io.BufferedRandom.tell`,
:func:`io.BufferedRandom.seek` and :func:`!_pyio.BufferedRandom.tell` being
able to return negative offsets.

..

.. date: 2022-08-26-15-50-53
.. gh-issue: 96310
.. nonce: 0NssDh
.. section: Library

Fix a traceback in :mod:`argparse` when all options in a mutually exclusive
group are suppressed.

..

.. date: 2022-05-25-17-49-04
.. gh-issue: 93205
.. nonce: DjhFVR
.. section: Library

Fixed a bug in :class:`logging.handlers.TimedRotatingFileHandler` where
multiple rotating handler instances pointing to files with the same name but
different extensions would conflict and not delete the correct files.

..

.. bpo: 31116
.. date: 2022-01-14-10-50-17
.. nonce: 0bduV9
.. section: Library

Add Z85 encoding to ``base64``.

..

.. bpo: 44865
.. date: 2021-08-24-20-47-37
.. nonce: c3BhZS
.. section: Library

Add missing call to localization function in :mod:`argparse`.

..

.. bpo: 43952
.. date: 2021-05-03-11-04-12
.. nonce: Me7fJe
.. section: Library

Fix :meth:`multiprocessing.connection.Listener.accept` to accept empty
bytes as authkey. Not accepting empty bytes as key causes it to hang
indefinitely.

..

.. bpo: 42125
.. date: 2020-12-15-22-30-49
.. nonce: UGyseY
.. section: Library

linecache: get module name from ``__spec__`` if available. This allows
getting source code for the ``__main__`` module when a custom loader is
used.

..

.. bpo: 41122
.. date: 2020-07-13-23-59-42
.. nonce: 8P_Brh
.. section: Library

Failing to pass arguments properly to :func:`functools.singledispatchmethod`
now throws a TypeError instead of hitting an index out of bounds internally.

..

.. bpo: 40818
.. date: 2020-05-29-18-08-54
.. nonce: Ij8ffq
.. section: Library

The asyncio REPL now runs :data:`sys.__interactivehook__` on startup. The
default implementation of :data:`sys.__interactivehook__` provides
auto-completion to the asyncio REPL. Patch contributed by Rémi Lapeyre.

..

.. bpo: 33775
.. date: 2019-04-06-23-50-59
.. nonce: 0yhMDc
.. section: Library

Add 'default' and 'version' help text for localization in argparse.

..

.. date: 2024-02-14-20-17-04
.. gh-issue: 115399
.. nonce: fb9a0R
.. section: Documentation

Document :cve:`2023-52425` of Expat <2.6.0 under "XML vulnerabilities".

..

.. date: 2024-02-08-08-51-37
.. gh-issue: 109653
.. nonce: QHLW4w
.. section: Documentation

Improve import time of :mod:`uuid` on Linux.

..

.. date: 2024-02-25-16-28-26
.. gh-issue: 71052
.. nonce: lSb9EC
.. section: Tests

Add test exclusions to support running the test suite on Android.

..

.. date: 2024-02-25-15-58-28
.. gh-issue: 71052
.. nonce: lxBjqY
.. section: Tests

Enable ``test_concurrent_futures`` on platforms that support threading but
not multiprocessing.

..

.. date: 2024-02-22-00-17-06
.. gh-issue: 115796
.. nonce: d4hpKy
.. section: Tests

Make '_testinternalcapi.assemble_code_object' construct the exception table
for the code object.

..

.. date: 2024-02-20-15-47-41
.. gh-issue: 115720
.. nonce: w8i8UG
.. section: Tests

Leak tests (``-R``, ``--huntrleaks``) now show a summary of the number of
leaks found in each iteration.

..

.. date: 2024-02-18-14-20-52
.. gh-issue: 115122
.. nonce: 3rGNo9
.. section: Tests

Add ``--bisect`` option to regrtest test runner: run failed tests with
``test.bisect_cmd`` to identify failing tests. Patch by Victor Stinner.

..

.. date: 2024-02-17-08-25-01
.. gh-issue: 115596
.. nonce: RGPCrR
.. section: Tests

Fix ``ProgramPriorityTests`` in ``test_os`` permanently changing the process
priority.

..

.. date: 2024-02-16-13-04-28
.. gh-issue: 115556
.. nonce: rjaQ9w
.. section: Tests

On Windows, commas passed in arguments to ``Tools\buildbot\test.bat`` and
``PCbuild\\rt.bat`` are now properly handled.

..

.. date: 2024-02-13-18-24-04
.. gh-issue: 115420
.. nonce: -dlzfI
.. section: Tests

Fix translation of exception handler targets by
``_testinternalcapi.optimize_cfg``.

..

.. date: 2024-02-12-22-35-01
.. gh-issue: 115376
.. nonce: n9vubZ
.. section: Tests

Fix segfault in ``_testinternalcapi.compiler_codegen`` on bad input.

..

.. date: 2024-03-04-12-43-42
.. gh-issue: 116313
.. nonce: cLLb8S
.. section: Build

Get WASI builds to work under wasmtime 18 w/ WASI 0.2/preview2 primitives.

..

.. date: 2024-03-01-16-44-19
.. gh-issue: 71052
.. nonce: Hs-9EP
.. section: Build

Change Android's :data:`sys.platform` from ``"linux"`` to ``"android"``.

..

.. date: 2024-02-29-15-12-31
.. gh-issue: 116117
.. nonce: eENkQK
.. section: Build

Backport ``libb2``'s PR #42 to fix compiling CPython on 32-bit Windows with
``clang-cl``.

..

.. date: 2024-02-26-14-54-58
.. gh-issue: 71052
.. nonce: XvFay1
.. section: Build

Fix several Android build issues

..

.. date: 2024-02-26-13-13-53
.. gh-issue: 114099
.. nonce: 8lpX-7
.. section: Build

A testbed project was added to run the test suite on iOS.

..

.. date: 2024-02-24-12-50-43
.. gh-issue: 115350
.. nonce: naQA6y
.. section: Build

Fix building ctypes module with -DWIN32_LEAN_AND_MEAN defined

..

.. date: 2024-02-21-18-22-49
.. gh-issue: 111225
.. nonce: Z8C3av
.. section: Build

Link extension modules against libpython on Android.

..

.. date: 2024-02-21-11-58-30
.. gh-issue: 115737
.. nonce: dpNl2T
.. section: Build

The install name for libPython is now correctly set for non-framework macOS
builds.

..

.. date: 2024-02-13-14-52-59
.. gh-issue: 114099
.. nonce: zjXsQr
.. section: Build

Makefile targets were added to support compiling an iOS-compatible framework
build.

..

.. date: 2024-02-27-23-21-55
.. gh-issue: 116012
.. nonce: B9_IwM
.. section: Windows

Ensure the value of ``GetLastError()`` is preserved across GIL operations.

..

.. date: 2024-02-23-11-43-43
.. gh-issue: 115582
.. nonce: sk1XPi
.. section: Windows

Building extensions intended for free-threaded builds of CPython now require
compiling with ``/DPy_GIL_DISABLED`` manually when using a regular install.
This is expected to change in future releases.

..

.. date: 2024-02-21-23-48-59
.. gh-issue: 115554
.. nonce: 02mpQC
.. section: Windows

The installer now has more strict rules about updating the :ref:`launcher`.
In general, most users only have a single launcher installed and will see no
difference. When multiple launchers have been installed, the option to
install the launcher is disabled until all but one have been removed.
Downgrading the launcher (which was never allowed) is now more obviously
blocked.

..

.. date: 2024-02-15-23-16-31
.. gh-issue: 115543
.. nonce: otrWnw
.. section: Windows

:ref:`launcher` can now detect Python 3.13 when installed from the Microsoft
Store, and will install Python 3.12 by default when
:envvar:`PYLAUNCHER_ALLOW_INSTALL` is set.

..

.. date: 2024-02-29-20-52-23
.. gh-issue: 116145
.. nonce: ygafim
.. section: macOS

Update macOS installer to Tcl/Tk 8.6.14.

..

.. date: 2023-12-09-11-04-26
.. gh-issue: 88516
.. nonce: SIIvfs
.. section: IDLE

On macOS show a proxy icon in the title bar of editor windows to match
platform behaviour.

..

.. date: 2023-02-12-19-28-08
.. gh-issue: 100176
.. nonce: Kzs4Zw
.. section: Tools/Demos

Remove outdated Tools/{io,cc,string}bench

..

.. bpo: 45101
.. date: 2021-09-05-02-47-48
.. nonce: 60Zqmt
.. section: Tools/Demos

Add consistency in usage message IO between 2 versions of python-config.

..

.. date: 2024-02-16-15-56-53
.. gh-issue: 114626
.. nonce: ie2esA
.. section: C API

Add again ``_PyCFunctionFastWithKeywords`` name, removed in Python 3.13
alpha 4 by mistake.  Keep the old private ``_PyCFunctionFastWithKeywords``
name (Python 3.7) as an alias to the new public name
``PyCFunctionFastWithKeywords`` (Python 3.13a4). Patch by Victor Stinner.

..

.. date: 2023-11-15-09-24-51
.. gh-issue: 111418
.. nonce: FYYetY
.. section: C API

Add :c:macro:`PyHASH_MODULUS`, :c:macro:`PyHASH_BITS`, :c:macro:`PyHASH_INF`
and :c:macro:`PyHASH_IMAG` C macros.  Patch by Sergey B Kirpichev.


================================================
File: /Misc/NEWS.d/3.13.0a6.rst
================================================
.. date: 2024-04-04-13-42-59
.. gh-issue: 117494
.. nonce: GPQH64
.. release date: 2024-04-09
.. section: Core and Builtins

Refactored the instruction sequence data structure out of compile.c into
instruction_sequence.c.

..

.. date: 2024-04-03-13-44-04
.. gh-issue: 116968
.. nonce: zgcdG2
.. section: Core and Builtins

Introduce a unified 16-bit backoff counter type (``_Py_BackoffCounter``),
shared between the Tier 1 adaptive specializer and the Tier 2 optimizer. The
API used for adaptive specialization counters is changed but the behavior is
(supposed to be) identical.

The behavior of the Tier 2 counters is changed:

* There are no longer dynamic thresholds (we never varied these).
* All counters now use the same exponential backoff.
* The counter for ``JUMP_BACKWARD`` starts counting down from 16.
* The ``temperature`` in side exits starts counting down from 64.

..

.. date: 2024-04-03-09-49-15
.. gh-issue: 117431
.. nonce: WAqRgc
.. section: Core and Builtins

Improve the performance of the following :class:`bytes` and
:class:`bytearray` methods by adapting them to the :c:macro:`METH_FASTCALL`
calling convention:

* :meth:`!endswith`
* :meth:`!startswith`

..

.. date: 2024-04-02-17-37-35
.. gh-issue: 117431
.. nonce: vDKAOn
.. section: Core and Builtins

Improve the performance of the following :class:`str` methods by adapting
them to the :c:macro:`METH_FASTCALL` calling convention:

* :meth:`~str.count`
* :meth:`~str.endswith`
* :meth:`~str.find`
* :meth:`~str.index`
* :meth:`~str.rfind`
* :meth:`~str.rindex`
* :meth:`~str.startswith`

..

.. date: 2024-04-02-10-04-57
.. gh-issue: 117411
.. nonce: YdyVmG
.. section: Core and Builtins

Move ``PyFutureFeatures`` to an internal header and make it private.

..

.. date: 2024-04-02-06-16-49
.. gh-issue: 109120
.. nonce: X485oN
.. section: Core and Builtins

Added handle of incorrect star expressions, e.g ``f(3, *)``. Patch by
